

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>isopy.core &mdash; isopy 0.3.4 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> isopy
          

          
          </a>

          
            
            
              <div class="version">
                0.3.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial_page.html">Tutorial</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../refpages/dtypes.html">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../refpages/reference_values.html">Reference values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../refpages/io.html">Read/Write</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../refpages/array_functions.html">Array functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../refpages/toolbox.html">Toolbox</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">isopy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>isopy.core</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for isopy.core</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">isopy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pyperclip</span> <span class="k">as</span> <span class="nn">pyperclip</span>
<span class="kn">import</span> <span class="nn">inspect</span> <span class="k">as</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">functools</span>

<span class="c1">#optional imports</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pandas</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">pandas</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">tables</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="kc">None</span>

<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="n">float64</span><span class="p">,</span> <span class="n">void</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">NoReturn</span><span class="p">,</span> <span class="n">Generic</span>

<span class="k">class</span> <span class="nc">NotGivenType</span><span class="p">:</span> <span class="k">pass</span>
<span class="n">NotGiven</span> <span class="o">=</span> <span class="n">NotGivenType</span><span class="p">()</span>

<span class="n">ALLOW_ALL_NUMPY_FUNCTIONS</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">ARRAY_REPR</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">include_row</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_dtype</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MassKeyString&#39;</span><span class="p">,</span> <span class="s1">&#39;ElementKeyString&#39;</span><span class="p">,</span> <span class="s1">&#39;IsotopeKeyString&#39;</span><span class="p">,</span> <span class="s1">&#39;RatioKeyString&#39;</span><span class="p">,</span> <span class="s1">&#39;GeneralKeyString&#39;</span><span class="p">,</span>
           <span class="s1">&#39;MassKeyList&#39;</span><span class="p">,</span> <span class="s1">&#39;ElementKeyList&#39;</span><span class="p">,</span> <span class="s1">&#39;IsotopeKeyList&#39;</span><span class="p">,</span> <span class="s1">&#39;RatioKeyList&#39;</span><span class="p">,</span> <span class="s1">&#39;GeneralKeyList&#39;</span><span class="p">,</span>
           <span class="s1">&#39;MassArray&#39;</span><span class="p">,</span> <span class="s1">&#39;ElementArray&#39;</span><span class="p">,</span> <span class="s1">&#39;IsotopeArray&#39;</span><span class="p">,</span> <span class="s1">&#39;RatioArray&#39;</span><span class="p">,</span> <span class="s1">&#39;GeneralArray&#39;</span><span class="p">,</span>
           <span class="s1">&#39;IsopyDict&#39;</span><span class="p">,</span> <span class="s1">&#39;ScalarDict&#39;</span><span class="p">,</span>
           <span class="s1">&#39;keystring&#39;</span><span class="p">,</span> <span class="s1">&#39;askeystring&#39;</span><span class="p">,</span> <span class="s1">&#39;keylist&#39;</span><span class="p">,</span> <span class="s1">&#39;askeylist&#39;</span><span class="p">,</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span> <span class="s1">&#39;asarray&#39;</span><span class="p">,</span> <span class="s1">&#39;asanyarray&#39;</span><span class="p">,</span>
           <span class="s1">&#39;ones&#39;</span><span class="p">,</span> <span class="s1">&#39;zeros&#39;</span><span class="p">,</span> <span class="s1">&#39;empty&#39;</span><span class="p">,</span> <span class="s1">&#39;full&#39;</span><span class="p">,</span>
           <span class="s1">&#39;concatenate&#39;</span><span class="p">,</span>
           <span class="s1">&#39;iskeystring&#39;</span><span class="p">,</span> <span class="s1">&#39;iskeylist&#39;</span><span class="p">,</span> <span class="s1">&#39;isarray&#39;</span><span class="p">,</span>
           <span class="s1">&#39;flavour&#39;</span><span class="p">,</span> <span class="s1">&#39;isflavour&#39;</span><span class="p">]</span>

<span class="n">CACHE_MAXSIZE</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">CACHES_ENABLED</span> <span class="o">=</span> <span class="kc">False</span>
<span class="c1">#TODO stackoverflow error that i cannot figure out</span>
<span class="k">def</span> <span class="nf">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">typed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignore_unhashable</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    decorator for functools.lru_cache but with the option to call the original function when an unhashable value</span>
<span class="sd">    is encountered.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">lru_cache_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="n">cached</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="p">,</span> <span class="n">typed</span><span class="p">)(</span><span class="n">func</span><span class="p">)</span>
        <span class="n">uncached</span> <span class="o">=</span> <span class="n">func</span>
        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">lru_cache_wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">CACHES_ENABLED</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">cached</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ignore_unhashable</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;unhashable&#39;</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">err</span>

            <span class="k">return</span> <span class="n">uncached</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">lru_cache_wrapper</span><span class="o">.</span><span class="n">__cached__</span> <span class="o">=</span> <span class="n">cached</span>
        <span class="n">lru_cache_wrapper</span><span class="o">.</span><span class="n">__uncached__</span> <span class="o">=</span> <span class="n">uncached</span>
        <span class="n">lru_cache_wrapper</span><span class="o">.</span><span class="n">cache_info</span> <span class="o">=</span> <span class="n">cached</span><span class="o">.</span><span class="n">cache_info</span>
        <span class="n">lru_cache_wrapper</span><span class="o">.</span><span class="n">clear_cache</span> <span class="o">=</span> <span class="n">cached</span><span class="o">.</span><span class="n">cache_clear</span>
        <span class="k">return</span> <span class="n">lru_cache_wrapper</span>
    <span class="k">return</span> <span class="n">lru_cache_decorator</span>

<span class="k">def</span> <span class="nf">updatedoc</span><span class="p">(</span><span class="n">ofunc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">fdict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Format the docstring of a function using the keyword arguments. If another</span>
<span class="sd">    function is passed as the first argument then the docstring from that function is used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ofunc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">func</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">ofunc</span>
        <span class="n">func</span><span class="o">.</span><span class="n">__doc__original</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span>
        <span class="n">fdoc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;__doc__original&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
        <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">fdoc</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">fdict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span>
    <span class="k">return</span> <span class="n">wrap</span>

<span class="c1">##################</span>
<span class="c1">### Exceptions ###</span>
<span class="c1">##################</span>
<span class="k">def</span> <span class="nf">_classname</span><span class="p">(</span><span class="n">thing</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span> <span class="k">return</span> <span class="n">thing</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">thing</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>


<span class="k">class</span> <span class="nc">IsopyException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">KeyStringException</span><span class="p">(</span><span class="n">IsopyException</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">KeyParseError</span><span class="p">(</span><span class="n">KeyStringException</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">KeyValueError</span><span class="p">(</span><span class="n">KeyParseError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">additional_information</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="n">string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cls</span> <span class="o">=</span> <span class="bp">cls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">additional_information</span> <span class="o">=</span> <span class="n">additional_information</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_classname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">)</span><span class="si">}</span><span class="s1">: unable to parse &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">string</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">additional_information</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s1">. </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">additional_information</span><span class="si">}</span><span class="s1">.&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">message</span>


<span class="k">class</span> <span class="nc">KeyTypeError</span><span class="p">(</span><span class="n">KeyParseError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cls</span> <span class="o">=</span> <span class="bp">cls</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_classname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">)</span><span class="si">}</span><span class="s1">: cannot convert </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span><span class="si">}</span><span class="s1"> into </span><span class="se">\&#39;</span><span class="s1">str</span><span class="se">\&#39;</span><span class="s1">&#39;</span>


<span class="k">class</span> <span class="nc">KeyListException</span><span class="p">(</span><span class="n">IsopyException</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">ListDuplicateError</span><span class="p">(</span><span class="n">KeyListException</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listobj</span><span class="p">,</span> <span class="n">list_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listobj</span> <span class="o">=</span> <span class="n">listobj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_</span> <span class="o">=</span> <span class="n">list_</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_classname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listobj</span><span class="p">)</span><span class="si">}</span><span class="s1">: duplicate key found in list </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">list_</span><span class="si">}</span><span class="s1">&#39;</span>


<span class="k">class</span> <span class="nc">ListSizeError</span><span class="p">(</span><span class="n">KeyListException</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listobj</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">other</span> <span class="o">=</span> <span class="n">other</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listobj</span> <span class="o">=</span> <span class="n">listobj</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_classname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listobj</span><span class="p">)</span><span class="si">}</span><span class="s1">: size of </span><span class="se">\&#39;</span><span class="si">{</span><span class="n">_classname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="se">\&#39;</span><span class="s1"> (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s1">) does not match current list (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listobj</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span>


<span class="k">class</span> <span class="nc">ListTypeError</span><span class="p">(</span><span class="n">KeyListException</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">listobj</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">other</span> <span class="o">=</span> <span class="n">other</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected</span> <span class="o">=</span> <span class="n">expected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listobj</span> <span class="o">=</span> <span class="n">listobj</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: Item must be a </span><span class="si">{}</span><span class="s1"> not </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_classname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listobj</span><span class="p">),</span> <span class="n">_classname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listobj</span><span class="p">),</span>
                                                     <span class="n">_classname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expected</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">NoCommomDenominator</span><span class="p">(</span><span class="n">KeyListException</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listobj</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listobj</span> <span class="o">=</span> <span class="n">listobj</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_classname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listobj</span><span class="p">)</span><span class="si">}</span><span class="s1">: list does not have a common denominator&#39;</span>


<span class="k">class</span> <span class="nc">NoKeysError</span><span class="p">(</span><span class="n">IsopyException</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">NDimError</span><span class="p">(</span><span class="n">IsopyException</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="c1">################</span>
<span class="c1">### Flavours ###</span>
<span class="c1">################</span>

<span class="k">class</span> <span class="nc">IsopyFlavour</span><span class="p">:</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__keystring</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;IsopyType not specified&#39;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;IsopyType not specified&#39;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__array</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;IsopyType not specified&#39;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__view_ndarray</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;IsopyType not specified&#39;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__view_void</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;IsopyType not specified&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MassFlavour</span><span class="p">:</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__keystring</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MassKeyString</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MassKeyList</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__array</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MassArray</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__view_void</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">view</span><span class="p">((</span><span class="n">MassVoid</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__view_ndarray</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">MassNdarray</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ElementFlavour</span><span class="p">:</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__keystring</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ElementKeyString</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ElementKeyList</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__array</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ElementArray</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__view_void</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">view</span><span class="p">((</span><span class="n">ElementVoid</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__view_ndarray</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">ElementNdarray</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">IsotopeFlavour</span><span class="p">:</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__keystring</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">IsotopeKeyString</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">IsotopeKeyList</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__array</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">IsotopeArray</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__view_void</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">view</span><span class="p">((</span><span class="n">IsotopeVoid</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__view_ndarray</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">IsotopeNdarray</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RatioFlavour</span><span class="p">:</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__keystring</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">RatioKeyString</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">RatioKeyList</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__array</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">RatioArray</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__view_void</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">view</span><span class="p">((</span><span class="n">RatioVoid</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__view_ndarray</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">RatioNdarray</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GeneralFlavour</span><span class="p">:</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__keystring</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GeneralKeyString</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GeneralKeyList</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__array</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GeneralArray</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__view_void</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">view</span><span class="p">((</span><span class="n">GeneralVoid</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_Flavour__view_ndarray</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">GeneralNdarray</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">isflavour</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;returns True if the favour of the first object is the same as the favour of the second object.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">flavour</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span> <span class="ow">is</span> <span class="n">flavour</span><span class="p">(</span><span class="n">obj2</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">flavour</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;returns the flavour type of the object.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">MassFlavour</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">MassFlavour</span>
        <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ElementFlavour</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ElementFlavour</span>
        <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">IsotopeFlavour</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">IsotopeFlavour</span>
        <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">RatioFlavour</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">RatioFlavour</span>
        <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">GeneralFlavour</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">GeneralFlavour</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="si">}</span><span class="s1"> is not an isopy object&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">MassFlavour</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">MassFlavour</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ElementFlavour</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ElementFlavour</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">IsotopeFlavour</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">IsotopeFlavour</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">RatioFlavour</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">RatioFlavour</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">GeneralFlavour</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">GeneralFlavour</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="si">}</span><span class="s1"> is not an isopy object&#39;</span><span class="p">)</span>

<span class="c1">##############</span>
<span class="c1">### Key ###</span>
<span class="c1">##############</span>
<span class="k">class</span> <span class="nc">IsopyKeyString</span><span class="p">(</span><span class="n">IsopyFlavour</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(&#39;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
        <span class="c1">#object.__setattr__(obj, &#39;_colname&#39;, string)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="nb">super</span><span class="p">(</span><span class="n">IsopyKeyString</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">())</span> <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> does not allow additional attributes&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">IsopyKeyString</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keystring</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">hash</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">askeylist</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">RatioFlavour</span><span class="o">.</span><span class="n">_Flavour__keystring</span><span class="p">((</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">askeylist</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">askeystring</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<div class="viewcode-block" id="MassKeyString"><a class="viewcode-back" href="../../refpages/Strings/isopy.MassKeyString.html#isopy.MassKeyString">[docs]</a><span class="k">class</span> <span class="nc">MassKeyString</span><span class="p">(</span><span class="n">MassFlavour</span><span class="p">,</span> <span class="n">IsopyKeyString</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    String representation of a mass number.</span>

<span class="sd">    Inherits from :class:`str` and therefore contains all the method that a :class:`str` does.</span>
<span class="sd">    Unless specifically noted below these methods will return a :class:`str` rather than a</span>
<span class="sd">    :class:`MassKeyString`.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string : str, int</span>
<span class="sd">        A string or integer representing an mass number.</span>
<span class="sd">    allow_reformatting : bool, Default = True</span>
<span class="sd">        If ``True`` the string will be reformatted to the correct format. If ``False`` an exception</span>
<span class="sd">        will be raised it the string is not correctly formatted.</span>


<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    KeyValueError</span>
<span class="sd">        Is raised when the supplied string cannot be parsed into the correct format</span>
<span class="sd">    KeyTypeError</span>
<span class="sd">        Raised when the supplied item cannot be turned into a string</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; isopy.MassKeyString(&#39;76&#39;)</span>
<span class="sd">    &#39;76&#39;</span>
<span class="sd">    &gt;&gt;&gt; isopy.MassKeyString(76)</span>
<span class="sd">    &#39;76&#39;</span>

<span class="sd">    Mass key strings also support the ``&lt;,&gt; &lt;=, &gt;=`` operators:</span>

<span class="sd">    &gt;&gt;&gt; isopy.MassKeyString(&#39;76&#39;) &gt; 75</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; isopy.MassKeyString(&#39;76&#39;) &lt;= 75</span>
<span class="sd">    False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">string</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">allow_reformatting</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">KeyTypeError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>

        <span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="c1"># string = string.removeprefix(&#39;_&#39;)</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="s1">&#39;Mass_&#39;</span><span class="p">)</span> <span class="c1">#For backwards compatibility</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="s1">&#39;MAS_&#39;</span><span class="p">)</span> <span class="c1">#For backwards compatibility</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">KeyValueError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="s1">&#39;cannot parse empty string&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">string</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">KeyValueError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="s1">&#39;Can only contain numerical characters&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">KeyValueError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="s1">&#39;Must be a positive integer&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">MassKeyString</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">item</span>

    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">item</span>

    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">item</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">item</span>

    <span class="k">def</span> <span class="nf">_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_eq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key_neq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">key_lt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key_gt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">key_le</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key_ge</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">invalid</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">invalid</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">key_eq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key_eq</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">key_neq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">key_neq</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">key_lt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">&lt;</span> <span class="n">key_lt</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">key_gt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">&gt;</span> <span class="n">key_gt</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">key_le</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">&lt;=</span> <span class="n">key_le</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">key_ge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">&gt;=</span> <span class="n">key_ge</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_sortkey</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="si">:</span><span class="s1">0&gt;4</span><span class="si">}</span><span class="s1">&#39;</span></div>


<div class="viewcode-block" id="ElementKeyString"><a class="viewcode-back" href="../../refpages/Strings/isopy.ElementKeyString.html#isopy.ElementKeyString">[docs]</a><span class="k">class</span> <span class="nc">ElementKeyString</span><span class="p">(</span><span class="n">ElementFlavour</span><span class="p">,</span> <span class="n">IsopyKeyString</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A string representation of an element symbol limited to two letters.</span>

<span class="sd">    The first letter is in upper case and subsequent letters are in lower case.</span>

<span class="sd">    Inherits from :class:`str` and therefore contains all the method that a :class:`str` does.</span>
<span class="sd">    Unless specifically noted below these methods will return a :class:`str` rather than a</span>
<span class="sd">    :class:`ElementKeyString`.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string : str</span>
<span class="sd">        A one or two letter string representing an element symbol. The letter case is not considered.</span>
<span class="sd">    allow_reformatting : bool, Default = True</span>
<span class="sd">        If ``True`` the string will be reformatted to the correct format. If ``False`` an exception</span>
<span class="sd">        will be raised it the string is not correctly formatted.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    KeyValueError</span>
<span class="sd">        Is raised when the supplied string cannot be parsed into the correct format</span>
<span class="sd">    KeyTypeError</span>
<span class="sd">        Raised when the supplied item cannot be turned into a string</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; isopy.ElementKeyString(&#39;Pd&#39;)</span>
<span class="sd">    &#39;Pd&#39;</span>
<span class="sd">    &gt;&gt;&gt; isopy.ElementKeyString(&#39;pd&#39;)</span>
<span class="sd">    &#39;pd&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">string</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">KeyTypeError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>

        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="s1">&#39;Element_&#39;</span><span class="p">)</span> <span class="c1">#For backwards compatibility</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="s1">&#39;ELE_&#39;</span><span class="p">)</span> <span class="c1">#For backwards compatibility</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">KeyValueError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="s1">&#39;Cannot parse empty string&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">KeyValueError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="s1">&#39;ElementKeyString is limited to two characters&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">string</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">KeyValueError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="s1">&#39;ElementKeyString is limited to alphabetical characters&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">allow_reformatting</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">string</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">islower</span><span class="p">()):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">KeyValueError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="s1">&#39;First character must be upper case and second character must be lower case&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">ElementKeyString</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_eq</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">key_neq</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">invalid</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">invalid</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">key_eq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key_eq</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">key_neq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">key_neq</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_sortkey</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">isopy</span><span class="o">.</span><span class="n">refval</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">atomic_number</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">z</span><span class="si">:</span><span class="s1">0&gt;4</span><span class="si">}</span><span class="s1">&#39;</span></div>


<div class="viewcode-block" id="IsotopeKeyString"><a class="viewcode-back" href="../../refpages/Strings/isopy.IsotopeKeyString.html#isopy.IsotopeKeyString">[docs]</a><span class="k">class</span> <span class="nc">IsotopeKeyString</span><span class="p">(</span><span class="n">IsotopeFlavour</span><span class="p">,</span> <span class="n">IsopyKeyString</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A string representation of an isotope consisting of a mass number followed by an element symbol.</span>

<span class="sd">    Inherits from :class:`str` and therefore contains all the method that a :class:`str` does.</span>
<span class="sd">    Unless specifically noted below these methods will return a :class:`str` rather than a</span>
<span class="sd">    :class:`IsotopeKeyString`.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string : str</span>
<span class="sd">        Should consist of an mass number and a valid element symbol. The order of the two does</span>
<span class="sd">        not matter.</span>
<span class="sd">    allow_reformatting : bool, Default = True</span>
<span class="sd">        If ``True`` the string will be reformatted to the correct format. If ``False`` an exception</span>
<span class="sd">        will be raised it the string is not correctly formatted.</span>


<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    KeyValueError</span>
<span class="sd">        Is raised when the supplied string cannot be parsed into the correct format</span>
<span class="sd">    KeyTypeError</span>
<span class="sd">        Raised when the supplied item cannot be turned into a string</span>


<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    mass_number : MassKeyString</span>
<span class="sd">        The mass number of the isotope</span>
<span class="sd">    element_symbol : ElementKeyString</span>
<span class="sd">        The element symbol of the isotope</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; isopy.IsotopeKeyString(&#39;Pd104&#39;)</span>
<span class="sd">    &#39;104Pd&#39;</span>
<span class="sd">    &gt;&gt;&gt; isopy.IsotopeKeyString(&#39;104pd&#39;)</span>
<span class="sd">    &#39;104Pd&#39;</span>
<span class="sd">    &gt;&gt;&gt; isopy.IsotopeKeyString(&#39;Pd104&#39;).mass_number</span>
<span class="sd">    &#39;104&#39;</span>
<span class="sd">    &gt;&gt;&gt; isopy.IsotopeKeyString(&#39;Pd104&#39;).element_symbol</span>
<span class="sd">    &#39;Pd&#39;</span>

<span class="sd">    ``in`` can be used to test if a string is equal to the mass number or an element symbol of an</span>
<span class="sd">    isotope key string.</span>

<span class="sd">    &gt;&gt;&gt; &#39;pd&#39; in isopy.IsotopeKeyString(&#39;Pd104&#39;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; 104 in isopy.IsotopeKeyString(&#39;Pd104&#39;)</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">string</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">KeyTypeError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>

        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">KeyValueError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="s1">&#39;Cannot parse empty string&#39;</span><span class="p">)</span>

        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="c1">#For backwards compatibility</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="s1">&#39;Isotope_&#39;</span><span class="p">)</span> <span class="c1">#For backwards compatibility</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="s1">&#39;ISO_&#39;</span><span class="p">)</span> <span class="c1">#For backwards compatibility</span>

        <span class="c1"># If no digits in string then only Symbol is given.</span>
        <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">KeyValueError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="s1">&#39;string does not contain a mass number&#39;</span><span class="p">)</span>

        <span class="c1"># If only digits then only mass number</span>
        <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">KeyValueError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="s1">&#39;string does not contain an element symbol&#39;</span><span class="p">)</span>

        <span class="c1"># Loop through to split</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">string</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">string</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>

            <span class="k">if</span> <span class="p">((</span><span class="n">mass</span><span class="o">:=</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="n">element</span><span class="o">:=</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">isalpha</span><span class="p">())</span> <span class="ow">or</span> <span class="p">((</span><span class="n">mass</span><span class="o">:=</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="n">element</span><span class="o">:=</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()):</span>
                <span class="n">mass</span> <span class="o">=</span> <span class="n">MassKeyString</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">)</span>
                <span class="n">element</span> <span class="o">=</span> <span class="n">ElementKeyString</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">)</span>

                <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">IsotopeKeyString</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span>
                                                           <span class="n">mass_number</span> <span class="o">=</span> <span class="n">mass</span><span class="p">,</span>
                                                           <span class="n">element_symbol</span> <span class="o">=</span> <span class="n">element</span><span class="p">)</span>

        <span class="k">raise</span> <span class="n">KeyValueError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="s1">&#39;unable to separate string into a mass number and an element symbol&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_number</span><span class="p">),</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element_symbol</span><span class="p">))</span> <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return **True** if `string` is equal to the IsotopeKeyString&#39;s mass number or element symbol</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_number</span> <span class="o">==</span> <span class="n">string</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_symbol</span> <span class="o">==</span> <span class="n">string</span>

    <span class="k">def</span> <span class="nf">_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_eq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key_neq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mass_number</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">element_symbol</span> <span class="o">=</span> <span class="p">{},</span> <span class="o">**</span><span class="n">invalid</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">invalid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">key_eq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key_eq</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">key_neq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">key_neq</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">mass_number</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_number</span><span class="o">.</span><span class="n">_filter</span><span class="p">(</span><span class="o">**</span><span class="n">mass_number</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">element_symbol</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_symbol</span><span class="o">.</span><span class="n">_filter</span><span class="p">(</span><span class="o">**</span><span class="n">element_symbol</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_sortkey</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_number</span><span class="o">.</span><span class="n">_sortkey</span><span class="p">()</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">element_symbol</span><span class="o">.</span><span class="n">_sortkey</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span></div>


<div class="viewcode-block" id="RatioKeyString"><a class="viewcode-back" href="../../refpages/Strings/isopy.RatioKeyString.html#isopy.RatioKeyString">[docs]</a><span class="k">class</span> <span class="nc">RatioKeyString</span><span class="p">(</span><span class="n">RatioFlavour</span><span class="p">,</span> <span class="n">IsopyKeyString</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A string representation of a ratio of two keystrings.</span>

<span class="sd">    Inherits from :class:`str` and therefore contains all the method that a :class:`str` does.</span>
<span class="sd">    Unless specifically noted below these methods will return a :class:`str` rather than a</span>
<span class="sd">    :class:`RatioKeyString`.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string : str, tuple[str, str]</span>
<span class="sd">        A string with the numerator and denominator seperated by &quot;/&quot; or a</span>
<span class="sd">        (numerator, denominator) tuple of strings. The numerator and denominator key</span>
<span class="sd">        strings can be of different flavours. Nested ratios can be created</span>
<span class="sd">        using a combination of &quot;/&quot;, &quot;//&quot;, &quot;///&quot; etc upto a maximum of 9 nested ratios.</span>
<span class="sd">    allow_reformatting : bool, Default = True</span>
<span class="sd">        If ``True`` the string will be reformatted to the correct format. If ``False`` an exception</span>
<span class="sd">        will be raised it the string is not correctly formatted.</span>


<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    KeyValueError</span>
<span class="sd">        Is raised when the supplied string cannot be parsed into the correct format</span>
<span class="sd">    KeyTypeError</span>
<span class="sd">        Raised when the supplied item cannot be turned into a string</span>


<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    numerator : :class:`MassKeyString`, :class:`ElementKeyString`, :class:`IsotopeKeyString`, :class:`RatioKeyString` or :class:`GeneralKeyString`</span>
<span class="sd">        The numerator key string</span>
<span class="sd">    denominator : :class:`MassKeyString`, :class:`ElementKeyString`, :class:`IsotopeKeyString`, :class:`RatioKeyString` or :class:`GeneralKeyString`</span>
<span class="sd">        The denominator key string</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; isopy.RatioKeyString(&#39;Pd108/105pd&#39;)</span>
<span class="sd">    &#39;104Pd/108Pd&#39;</span>
<span class="sd">    &gt;&gt;&gt; isopy.RatioKeyString((&#39;Pd108&#39;, &#39;105pd&#39;))</span>
<span class="sd">    &#39;104Pd/108Pd&#39;</span>
<span class="sd">    &gt;&gt;&gt; isopy.RatioKeyString(&#39;108pd/ge&#39;) #You can mix flavours</span>
<span class="sd">    &#39;104Pd/Ge&#39;</span>
<span class="sd">    &gt;&gt;&gt; isopy.RatioKeyString(&#39;108pd/ge&#39;).numerator</span>
<span class="sd">    &#39;108Pd&#39;</span>
<span class="sd">    &gt;&gt;&gt; isopy.RatioKeyString(&#39;108pd/ge&#39;).denominator</span>
<span class="sd">    &#39;Ge&#39;</span>

<span class="sd">    Nested arrays</span>

<span class="sd">    &gt;&gt;&gt; isopy.RatioKeyString(&#39;Pd108/105pd//ge&#39;)</span>
<span class="sd">    &#39;108Pd/105Pd//Ge</span>
<span class="sd">    &gt;&gt;&gt; isopy.RatioKeyString(((&#39;Pd108&#39;, &#39;105pd&#39;), &#39;ge&#39;))</span>
<span class="sd">    &#39;108Pd/105Pd//Ge</span>
<span class="sd">    &gt;&gt;&gt; isopy.RatioKeyString(&#39;Pd108/105pd//as/ge&#39;)</span>
<span class="sd">    &#39;108Pd/105Pd//As/Ge</span>
<span class="sd">    &gt;&gt;&gt; isopy.RatioKeyString((&#39;Pd108/105pd&#39;, &#39;as/ge&#39;))</span>
<span class="sd">    &#39;108Pd/105Pd//As/Ge</span>
<span class="sd">    &gt;&gt;&gt; isopy.RatioKeyString((&#39;Pd108/105pd&#39;, &#39;as/ge&#39;)).numerator</span>
<span class="sd">    &#39;108Pd/105Pd&#39;</span>
<span class="sd">    &gt;&gt;&gt; isopy.RatioKeyString((&#39;Pd108/105pd&#39;, &#39;as/ge&#39;)).denominator</span>
<span class="sd">    &#39;As/Ge&#39;</span>

<span class="sd">    ``in`` can be used to test if a string is equal to the numerator or denominator of the ratio.</span>

<span class="sd">    &gt;&gt;&gt; &#39;pd108&#39; in isopy.RatioKeyString(&#39;108Pd/Ge&#39;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; &#39;as/ge&#39; in isopy.RatioKeyString(&#39;Pd108/105pd//as/ge&#39;)</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">string</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">numer</span><span class="p">,</span> <span class="n">denom</span> <span class="o">=</span> <span class="n">string</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">KeyTypeError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="c1"># For backwards compatibility</span>
            <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Ratio_&#39;</span><span class="p">):</span>
                <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="s1">&#39;Ratio_&#39;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">numer</span><span class="p">,</span> <span class="n">denom</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">KeyValueError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span>
                                        <span class="s1">&#39;unable to split string into numerator and denominator&#39;</span><span class="p">)</span>

            <span class="c1"># For backwards compatibility</span>
            <span class="k">elif</span> <span class="n">string</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;RAT&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">string</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">numer</span><span class="p">,</span> <span class="n">denom</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;_OVER</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">_&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">KeyValueError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span>
                                        <span class="s1">&#39;unable to split string into numerator and denominator&#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">divider</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">*</span> <span class="n">n</span>
                    <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">divider</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">numer</span><span class="p">,</span> <span class="n">denom</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">divider</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">KeyValueError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span>
                                            <span class="s1">&#39;unable to split string into numerator and denominator&#39;</span><span class="p">)</span>

        <span class="n">numer</span> <span class="o">=</span> <span class="n">askeystring</span><span class="p">(</span><span class="n">numer</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">)</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">askeystring</span><span class="p">(</span><span class="n">denom</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
            <span class="n">divider</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">*</span> <span class="n">n</span>
            <span class="k">if</span> <span class="n">numer</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">divider</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">denom</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">divider</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">KeyValueError</span><span class="p">(</span><span class="s1">&#39;Limit of nested ratios reached&#39;</span><span class="p">)</span>

        <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">numer</span><span class="si">}{</span><span class="n">divider</span><span class="si">}{</span><span class="n">denom</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="c1">#colname = f&#39;RAT{n}_{numer.colname}_OVER{n}_{denom.colname}&#39;</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">RatioKeyString</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span>
                                                  <span class="n">numerator</span> <span class="o">=</span> <span class="n">numer</span><span class="p">,</span> <span class="n">denominator</span> <span class="o">=</span> <span class="n">denom</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numerator</span><span class="p">),</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">))</span> <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return **True** if `string` is equal to the RatioKeyString&#39;s numerator or denominator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">numerator</span> <span class="o">==</span> <span class="n">string</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span> <span class="o">==</span> <span class="n">string</span>

    <span class="k">def</span> <span class="nf">_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_eq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key_neq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">numerator</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">denominator</span> <span class="o">=</span> <span class="p">{},</span> <span class="o">**</span><span class="n">invalid</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">invalid</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">key_eq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key_eq</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">key_neq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">key_neq</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">numerator</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">numerator</span><span class="o">.</span><span class="n">_filter</span><span class="p">(</span><span class="o">**</span><span class="n">numerator</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">denominator</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="o">.</span><span class="n">_filter</span><span class="p">(</span><span class="o">**</span><span class="n">denominator</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_sortkey</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="o">.</span><span class="n">_sortkey</span><span class="p">()</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">numerator</span><span class="o">.</span><span class="n">_sortkey</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span></div>


<div class="viewcode-block" id="GeneralKeyString"><a class="viewcode-back" href="../../refpages/Strings/isopy.GeneralKeyString.html#isopy.GeneralKeyString">[docs]</a><span class="k">class</span> <span class="nc">GeneralKeyString</span><span class="p">(</span><span class="n">GeneralFlavour</span><span class="p">,</span> <span class="n">IsopyKeyString</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A general key string that can hold any string value.</span>

<span class="sd">    No formatting is applied to the string.</span>

<span class="sd">    Inherits from :class:`str` and therefore contains all the method that a :class:`str` does.</span>
<span class="sd">    Unless specifically noted below these methods will return a :class:`str` rather than a</span>
<span class="sd">    :class:`GeneralKeyString`.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string : str</span>
<span class="sd">        Any string will work as GeneralKeyString</span>
<span class="sd">    allow_reformatting : bool, Default = True</span>
<span class="sd">        If ``True`` the string will be reformatted to the correct format. If ``False`` an exception</span>
<span class="sd">        will be raised it the string is not correctly formatted.</span>


<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    KeyValueError</span>
<span class="sd">        Is raised when the supplied string cannot be parsed into the correct format</span>
<span class="sd">    KeyTypeError</span>
<span class="sd">        Raised when the supplied item cannot be turned into a string</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; isopy.GeneralKeyString(&#39;harry&#39;)</span>
<span class="sd">    &#39;harry&#39;</span>
<span class="sd">    &gt;&gt;&gt; isopy.GeneralKeyString(&#39;Hermione/Ron&#39;)</span>
<span class="sd">    &#39;Hermione/Ron&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">string</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">allow_reformatting</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">KeyTypeError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">KeyTypeError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">KeyValueError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="s1">&#39;Cannot parse empty string&#39;</span><span class="p">)</span>

        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="s1">&#39;GEN_&#39;</span><span class="p">)</span> <span class="c1">#For backwards compatibility</span>
        <span class="c1">#colname = string.replace(&#39;/&#39;, &#39;_SLASH_&#39;) #For backwards compatibility</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_SLASH_&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="c1">#For backwards compatibility</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">GeneralKeyString</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_eq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key_neq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">invalid</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">invalid</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">key_eq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key_eq</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">key_neq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">key_neq</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_sortkey</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<span class="c1">############</span>
<span class="c1">### List ###</span>
<span class="c1">############</span>

<span class="c1">#TODO document sorted with exampels in each key string</span>

<span class="k">class</span> <span class="nc">IsopyKeyList</span><span class="p">(</span><span class="n">IsopyFlavour</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When comparing the list against another list the order of items is not considered.</span>
<span class="sd">    The ``in`` operator can be used to test whether a string is in the list. To test whether all items in a list are</span>
<span class="sd">    present in another list use the ``&lt;=`` operator.</span>

<span class="sd">    The ``&amp;``, ``|`` and ``^`` operators can be used in combination with another list for an unordered item to item</span>
<span class="sd">    comparison. The and (``&amp;``) operator will return the items that occur in both lists. The or (``|``) operator</span>
<span class="sd">    will return all items that appear in at least one of the lists. The xor (``^``) operator will return the items</span>
<span class="sd">    that do not appear in both lists. All duplicate items will be removed from the returned lists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">keys</span><span class="p">,</span> <span class="n">skip_duplicates</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">allow_duplicates</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">allow_reformatting</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="n">new_keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">new_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_Flavour__keystring</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span><span class="o">.</span><span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_keys</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">cls</span><span class="o">.</span><span class="n">_Flavour__keystring</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">key</span><span class="o">.</span><span class="n">names</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_keys</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">cls</span><span class="o">.</span><span class="n">_Flavour__keystring</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">key</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
                <span class="n">new_keys</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">cls</span><span class="o">.</span><span class="n">_Flavour__keystring</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_Flavour__keystring</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">skip_duplicates</span><span class="p">:</span>
            <span class="n">new_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">new_keys</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">allow_duplicates</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">new_keys</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_keys</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">ListDuplicateError</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">new_keys</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">IsopyKeyList</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">new_keys</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">IsopyKeyList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span><span class="si">}</span><span class="s1">)&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">IsopyKeyList</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">hash</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__le</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">IsopyKeyList</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">other</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">key</span><span class="p">):</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__lt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">IsopyKeyList</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__le__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__ge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">IsopyKeyList</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__gt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">IsopyKeyList</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return **True** if `item` is present in the list. Otherwise return **False**.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">(</span><span class="n">items</span><span class="p">,)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">IsopyKeyString</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keystring</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">super</span><span class="p">(</span><span class="n">IsopyKeyList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the item at `index`. `index` can be int, slice or sequence of int.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="nb">super</span><span class="p">(</span><span class="n">IsopyKeyList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">IsopyKeyList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">IsopyKeyList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">denominator</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">denominator</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">raise</span> <span class="n">ListSizeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">denominator</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">RatioFlavour</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">RatioFlavour</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="n">denominator</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>

    <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numerator</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">numerator</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">numerator</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">raise</span> <span class="n">ListSizeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numerator</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">RatioFlavour</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">numerator</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">d</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">RatioFlavour</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">numerator</span> <span class="o">/</span> <span class="n">d</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="nb">super</span><span class="p">(</span><span class="n">IsopyKeyList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="n">out</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keystring</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">IsopyKeyList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">IsopyKeyList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keystring</span><span class="p">(</span><span class="n">item</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">KeyValueError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s1"> not in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">has_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns ``True`` if the list contains duplicates items. Otherwise it returns ``False``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">strlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of ``str`` object for each key in the key list.</span>

<span class="sd">        Analogous to ``[str(key) for key in keylist]``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a sorted key string list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span> <span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="o">.</span><span class="n">_sortkey</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">reversed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a reversed key string list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sorted</span><span class="p">())</span>

    <span class="c1">##########################################</span>
    <span class="c1">### Cached methods for increased speed ###</span>
    <span class="c1">##########################################</span>

    <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">CACHE_MAXSIZE</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">others</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">other</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">KeyParseError</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">GeneralFlavour</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                    <span class="n">other</span> <span class="o">=</span> <span class="n">GeneralFlavour</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="n">this</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
            <span class="n">other</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
            <span class="n">other_hash</span> <span class="o">=</span> <span class="p">[</span><span class="nb">hash</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">other</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">this</span> <span class="k">if</span> <span class="nb">hash</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="ow">in</span> <span class="n">other_hash</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">CACHE_MAXSIZE</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">others</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">other</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">KeyParseError</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">GeneralFlavour</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                    <span class="n">other</span> <span class="o">=</span> <span class="n">GeneralFlavour</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">((</span><span class="o">*</span><span class="n">result</span><span class="p">,</span> <span class="o">*</span><span class="n">other</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">CACHE_MAXSIZE</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">others</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">other</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">KeyParseError</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">GeneralFlavour</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                    <span class="n">other</span> <span class="o">=</span> <span class="n">GeneralFlavour</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

            <span class="n">this</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
            <span class="n">other</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
            <span class="n">this_hash</span> <span class="o">=</span> <span class="p">[</span><span class="nb">hash</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">this</span><span class="p">]</span>
            <span class="n">other_hash</span> <span class="o">=</span> <span class="p">[</span><span class="nb">hash</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">other</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">this</span> <span class="k">if</span> <span class="nb">hash</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">other_hash</span><span class="p">),</span>
                                              <span class="o">*</span><span class="p">(</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">other</span> <span class="k">if</span> <span class="nb">hash</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">this_hash</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">CACHE_MAXSIZE</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__rand__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">GeneralFlavour</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__rand__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">CACHE_MAXSIZE</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__ror__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">GeneralFlavour</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__ror__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">CACHE_MAXSIZE</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__rxor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">GeneralFlavour</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__rxor__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="fm">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<div class="viewcode-block" id="MassKeyList"><a class="viewcode-back" href="../../refpages/Lists/isopy.MassKeyList.html#isopy.MassKeyList">[docs]</a><span class="k">class</span> <span class="nc">MassKeyList</span><span class="p">(</span><span class="n">MassFlavour</span><span class="p">,</span> <span class="n">IsopyKeyList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A tuple consisting exclusively of :class:`MassKeyString` items.</span>

<span class="sd">    Behaves just like, and contains all the methods, that a normal tuple does unless otherwise noted.</span>
<span class="sd">    Only methods that behave differently from a normal python tuples are documented below.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    keys : str, int,  Sequence[(str, int)]</span>
<span class="sd">        A string or sequence of strings that can be converted to the correct key string type.</span>
<span class="sd">    skip_duplicates : bool, Default = True</span>
<span class="sd">        If ``True`` all duplicate items will be removed from the sequence.</span>
<span class="sd">    allow_duplicates : bool, Default  = True</span>
<span class="sd">        If ``False`` a ListDuplicateError will be raised if the sequence contains any duplicate items.</span>
<span class="sd">    allow_reformatting : bool, Default = True</span>
<span class="sd">        If ``True`` the string will be reformatted to the correct format. If ``False`` an exception</span>
<span class="sd">        will be raised it the string is not correctly formatted.</span>


<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ListDuplicateError</span>
<span class="sd">        Raised when a string already exist in the sequence and ``allow_duplicates = False``</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; MassKeyList([99, 105, &#39;111&#39;])</span>
<span class="sd">    (&#39;99&#39;, &#39;105&#39;, &#39;111&#39;])</span>
<span class="sd">    &gt;&gt;&gt; MassKeyList(&#39;99&#39;, 105,&#39;111&#39;)</span>
<span class="sd">    (&#39;99&#39;, &#39;105&#39;, &#39;111&#39;)</span>
<span class="sd">    &gt;&gt;&gt; MassKeyList(&#39;99&#39;, [&#39;105&#39;, 111])</span>
<span class="sd">    (&#39;99&#39;, &#39;105&#39;, &#39;111&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MassKeyList.filter"><a class="viewcode-back" href="../../refpages/Lists/isopy.MassKeyList.html#isopy.MassKeyList.filter">[docs]</a>    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_eq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key_neq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">key_lt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">key_gt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key_le</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key_ge</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a new key string list containing only the key strings that satisfies the specified</span>
<span class="sd">        filters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key_eq : str, int, Sequence[(str, int)]</span>
<span class="sd">           Only key strings equal to/found in *key_eq* pass this filter.</span>
<span class="sd">        key_neq : str, int, Sequence[(str, int)]</span>
<span class="sd">           Only key strings not equal to/found in *key_neq* pass this filter.</span>
<span class="sd">        key_lt : str, int</span>
<span class="sd">            Only key strings less than *key_lt* pass this filter.</span>
<span class="sd">        key_gt : str, int</span>
<span class="sd">            Only key strings greater than *key_gt* pass this filter.</span>
<span class="sd">        key_le : str, int</span>
<span class="sd">            Only key strings less than or equal to *key_le* pass this filter.</span>
<span class="sd">        key_ge : str, int</span>
<span class="sd">            Only key strings greater than or equal to *key_ge* pass this filter.</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : MassKeyList</span>
<span class="sd">            Key strings in the sequence that satisfy the specified filters</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; keylist = MassKeyList([&#39;99&#39;, &#39;105&#39;, &#39;111&#39;])</span>
<span class="sd">        &gt;&gt;&gt; keylist.filter(key_eq=[105, 107, 111])</span>
<span class="sd">        (&#39;105&#39;, &#39;111&#39;)</span>
<span class="sd">        &gt;&gt;&gt; keylist.filter(key_neq=&#39;111&#39;])</span>
<span class="sd">        (&#39;99&#39;, &#39;105&#39;)</span>
<span class="sd">        &gt;&gt;&gt; keylist.filter(key_gt=&#39;99&#39;])</span>
<span class="sd">        (&#39;105&#39;, &#39;111&#39;)</span>
<span class="sd">        &gt;&gt;&gt; keylist.filter(key_le=105])</span>
<span class="sd">        (&#39;99&#39;, &#39;105&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filters</span> <span class="o">=</span> <span class="n">parse_keyfilters</span><span class="p">(</span><span class="n">key_eq</span><span class="o">=</span><span class="n">key_eq</span><span class="p">,</span> <span class="n">key_neq</span><span class="o">=</span><span class="n">key_neq</span><span class="p">,</span>
                                     <span class="n">key_lt</span><span class="o">=</span><span class="n">key_lt</span><span class="p">,</span> <span class="n">key_gt</span><span class="o">=</span><span class="n">key_gt</span><span class="p">,</span>
                                     <span class="n">key_le</span><span class="o">=</span><span class="n">key_le</span><span class="p">,</span> <span class="n">key_ge</span><span class="o">=</span><span class="n">key_ge</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">_filter</span><span class="p">(</span><span class="o">**</span><span class="n">filters</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="ElementKeyList"><a class="viewcode-back" href="../../refpages/Lists/isopy.ElementKeyList.html#isopy.ElementKeyList">[docs]</a><span class="k">class</span> <span class="nc">ElementKeyList</span><span class="p">(</span><span class="n">ElementFlavour</span><span class="p">,</span> <span class="n">IsopyKeyList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A tuple consisting exclusively of :class:`ElementKeyString` items.</span>

<span class="sd">    Behaves just like, and contains all the methods, that a normal tuple does unless otherwise noted.</span>
<span class="sd">    Only methods that behave differently from a normal python tuples are documented below.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    keys : str, Sequence[str]</span>
<span class="sd">        A string or sequence of strings that can be converted to the correct key string type.</span>
<span class="sd">    skip_duplicates : bool, Default = True</span>
<span class="sd">        If ``True`` all duplicate items will be removed from the sequence.</span>
<span class="sd">    allow_duplicates : bool, Default  = True</span>
<span class="sd">        If ``False`` a ListDuplicateError will be raised if the sequence contains any duplicate items.</span>
<span class="sd">    allow_reformatting : bool, Default = True</span>
<span class="sd">        If ``True`` the string will be reformatted to the correct format. If ``False`` an exception</span>
<span class="sd">        will be raised it the string is not correctly formatted.</span>


<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ListDuplicateError</span>
<span class="sd">        Raised when a string already exist in the sequence and ``allow_duplicates = False``</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; ElementKeyList([&#39;ru&#39;, &#39;pd&#39;, &#39;cd&#39;])</span>
<span class="sd">    (&#39;Ru&#39;, &#39;Pd&#39;, &#39;Cd&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ElementKeyList(&#39;ru&#39;, &#39;pd&#39; , &#39;cd&#39;)</span>
<span class="sd">    (&#39;Ru&#39;, &#39;Pd&#39;, &#39;Cd&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ElementKeyList(&#39;ru&#39;, [&#39;pd&#39; , &#39;cd&#39;])</span>
<span class="sd">    (&#39;Ru&#39;, &#39;Pd&#39;, &#39;Cd&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ElementKeyList.filter"><a class="viewcode-back" href="../../refpages/Lists/isopy.ElementKeyList.html#isopy.ElementKeyList.filter">[docs]</a>    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_eq</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">key_neq</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a new key string list containing only the key strings that satisfies the specified</span>
<span class="sd">        filters.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key_eq : str, Sequence[str], Optional</span>
<span class="sd">           Only key strings equal to/found in *key_eq* pass this filter.</span>
<span class="sd">        key_neq : str, Sequence[str], Optional</span>
<span class="sd">           Only key strings not equal to/found in *key_neq* pass this filter.</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : ElementKeyList</span>
<span class="sd">            Key strings in the sequence that satisfy the specified filters</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; keylist = ElementKeyList([&#39;ru&#39;, &#39;pd&#39;, &#39;cd&#39;])</span>
<span class="sd">        &gt;&gt;&gt; keylist.filter(key_eq=[&#39;pd&#39;,&#39;ag&#39;, &#39;cd&#39;])</span>
<span class="sd">        (&#39;Pd&#39;, &#39;Cd&#39;)</span>
<span class="sd">        &gt;&gt;&gt; keylist.filter(key_neq=&#39;cd&#39;)</span>
<span class="sd">        (&#39;Ru&#39;, &#39;Pd&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="n">parse_keyfilters</span><span class="p">(</span><span class="n">key_eq</span><span class="o">=</span><span class="n">key_eq</span><span class="p">,</span> <span class="n">key_neq</span><span class="o">=</span><span class="n">key_neq</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">_filter</span><span class="p">(</span><span class="o">**</span><span class="n">filters</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="IsotopeKeyList"><a class="viewcode-back" href="../../refpages/Lists/isopy.IsotopeKeyList.html#isopy.IsotopeKeyList">[docs]</a><span class="k">class</span> <span class="nc">IsotopeKeyList</span><span class="p">(</span><span class="n">IsotopeFlavour</span><span class="p">,</span> <span class="n">IsopyKeyList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A tuple consisting exclusively of :class:`IsotopeKeyString` items.</span>

<span class="sd">    Behaves just like, and contains all the methods, that a normal tuple does unless otherwise noted.</span>
<span class="sd">    Only methods that behave differently from a normal python tuples are documented below.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    keys : str, Sequence[str]</span>
<span class="sd">        A string or sequence of strings that can be converted to the correct key string type.</span>
<span class="sd">    skip_duplicates : bool, Default = True</span>
<span class="sd">        If ``True`` all duplicate items will be removed from the sequence.</span>
<span class="sd">    allow_duplicates : bool, Default  = True</span>
<span class="sd">        If ``False`` a ListDuplicateError will be raised if the sequence contains any duplicate items.</span>
<span class="sd">    allow_reformatting : bool, Default = True</span>
<span class="sd">        If ``True`` the string will be reformatted to the correct format. If ``False`` an exception</span>
<span class="sd">        will be raised it the string is not correctly formatted.</span>


<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ListDuplicateError</span>
<span class="sd">        Raised when a string already exist in the sequence and ``allow_duplicates = False``</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; IsotopeKeyList([&#39;99ru&#39;, &#39;105pd&#39;, &#39;111cd&#39;])</span>
<span class="sd">    (&#39;99Ru&#39;, &#39;105Pd&#39;, &#39;111Cd&#39;)</span>
<span class="sd">    &gt;&gt;&gt; IsotopeKeyList(&#39;99ru&#39;, &#39;105pd&#39; , &#39;cd111&#39;)</span>
<span class="sd">    (&#39;99Ru&#39;, &#39;105Pd&#39;, &#39;111Cd&#39;)</span>
<span class="sd">    &gt;&gt;&gt; IsotopeKeyList(&#39;99ru&#39;, [&#39;105pd&#39;, &#39;cd111&#39;])</span>
<span class="sd">    (&#39;99Ru&#39;, &#39;105Pd&#39;, &#39;111Cd&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">cache</span>
    <span class="k">def</span> <span class="nf">mass_numbers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MassKeyList</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a :class:`MassKeyList` containing the mass number of each item in the list.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; IsotopeKeyList([&#39;99ru&#39;, &#39;105pd&#39;, &#39;111cd&#39;]).mass_numbers()</span>
<span class="sd">        (&#39;99&#39;, &#39;105&#39;, &#39;111&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MassFlavour</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mass_number</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">cache</span>
    <span class="k">def</span> <span class="nf">element_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ElementKeyList</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an :class:`ElementKeyList` containing the element symbol of each item in the list.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; IsotopeKeyList([&#39;99ru&#39;, &#39;105pd&#39;, &#39;111cd&#39;]).element_symbols()</span>
<span class="sd">        (&#39;Ru&#39;, &#39;Pd&#39;, &#39;Cd&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ElementFlavour</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">element_symbol</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">))</span>

<div class="viewcode-block" id="IsotopeKeyList.filter"><a class="viewcode-back" href="../../refpages/Lists/isopy.IsotopeKeyList.html#isopy.IsotopeKeyList.filter">[docs]</a>    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_eq</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="n">key_neq</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="o">**</span><span class="n">mass_number_and_element_symbol_kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;IsotopeKeyList&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a new key string list containing only the key strings that satisfies the specified</span>
<span class="sd">        filters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key_eq : str, Sequence[str], Optional</span>
<span class="sd">           Only key strings equal to/found in *key_eq* pass this filter.</span>
<span class="sd">        key_neq : str, Sequence[str], Optional</span>
<span class="sd">           Only key strings not equal to/found in *key_neq* pass this filter.</span>
<span class="sd">        mass_number_and_element_symbol_kwargs : str, Sequence[str], Optional</span>
<span class="sd">            Filter based on the mass number or element symbol of the key strings. Prefix</span>
<span class="sd">            :func:`MassKeyList.filter` filters with ``mass_number_ and :func:`Element.filter`</span>
<span class="sd">            filters with ``element_symbol``.</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : IsotopeKeyList</span>
<span class="sd">            Key strings in the sequence that satisfy the specified filters</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; keylist = IsotopeKeyList([&#39;99ru&#39;, &#39;105pd&#39;, &#39;111cd&#39;])</span>
<span class="sd">        &gt;&gt;&gt; keylist.filter(key_eq=[&#39;105pd&#39;,&#39;107ag&#39;, &#39;111cd&#39;])</span>
<span class="sd">        (&#39;105Pd&#39;, &#39;111Cd)</span>
<span class="sd">        &gt;&gt;&gt; keylist.filter(key_neq=&#39;111cd&#39;)</span>
<span class="sd">        (&#39;99Ru&#39;, &#39;105Pd&#39;)</span>
<span class="sd">        &gt;&gt;&gt; keylist.filter(mass_number_key_gt = 100)</span>
<span class="sd">        (&#39;105Pd&#39;, &#39;111Cd)</span>
<span class="sd">        &gt;&gt;&gt; keylist.filter(element_symbol_key_neq=&#39;pd&#39;])</span>
<span class="sd">        (&#39;99Ru&#39;, &#39;111Cd)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="n">parse_keyfilters</span><span class="p">(</span><span class="n">key_eq</span><span class="o">=</span><span class="n">key_eq</span><span class="p">,</span> <span class="n">key_neq</span><span class="o">=</span><span class="n">key_neq</span><span class="p">,</span>
                                   <span class="o">**</span><span class="n">mass_number_and_element_symbol_kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">_filter</span><span class="p">(</span><span class="o">**</span><span class="n">filters</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="RatioKeyList"><a class="viewcode-back" href="../../refpages/Lists/isopy.RatioKeyList.html#isopy.RatioKeyList">[docs]</a><span class="k">class</span> <span class="nc">RatioKeyList</span><span class="p">(</span><span class="n">RatioFlavour</span><span class="p">,</span> <span class="n">IsopyKeyList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A tuple consisting exclusively of :class:`RatioKeyString` items.</span>

<span class="sd">    Behaves just like, and contains all the methods, that a normal tuple does unless otherwise noted.</span>
<span class="sd">    Only methods that behave differently from a normal python tuples are documented below.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    keys : str, tuple[str, str], Sequence[str, tuple[str, str]]</span>
<span class="sd">        A string or sequence of strings that can be converted to the correct key string type.</span>
<span class="sd">    skip_duplicates : bool, Default = True</span>
<span class="sd">        If ``True`` all duplicate items will be removed from the sequence.</span>
<span class="sd">    allow_duplicates : bool, Default  = True</span>
<span class="sd">        If ``False`` a ListDuplicateError will be raised if the sequence contains any duplicate items.</span>
<span class="sd">    allow_reformatting : bool, Default = True</span>
<span class="sd">        If ``True`` the string will be reformatted to the correct format. If ``False`` an exception</span>
<span class="sd">        will be raised it the string is not correctly formatted.</span>


<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ListDuplicateError</span>
<span class="sd">        Raised when a string already exist in the sequence and ``allow_duplicates = False``</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; RatioKeyList([&#39;99ru/108Pd&#39;, &#39;105pd/108Pd&#39;, &#39;111cd/108Pd&#39;])</span>
<span class="sd">    (&#39;99Ru/108Pd&#39;, &#39;105Pd/108Pd&#39;, &#39;111Cd/108Pd&#39;)</span>
<span class="sd">    &gt;&gt;&gt; RatioKeyList(&#39;99ru/108Pd&#39;, &#39;105pd/108Pd&#39; ,&#39;cd111/108Pd&#39;)</span>
<span class="sd">    (&#39;99Ru/108Pd&#39;, &#39;105Pd/108Pd&#39;, &#39;111Cd/108Pd&#39;)</span>
<span class="sd">    &gt;&gt;&gt; RatioKeyList(&#39;99ru/108Pd&#39;, [&#39;105pd/108Pd&#39; ,&#39;cd111/108Pd&#39;])</span>
<span class="sd">    (&#39;99Ru/108Pd&#39;, &#39;105Pd/108Pd&#39;, &#39;111Cd/108Pd&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">cache</span>
    <span class="k">def</span> <span class="nf">numerators</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IsopyKeyList</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an isopy list containing the numerators for each ration in the sequence.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; RatioKeyList([&#39;99ru/108Pd&#39;, &#39;105pd/108Pd&#39;, &#39;111cd/108Pd&#39;]).numerators</span>
<span class="sd">        (&#39;99Ru&#39;, &#39;105Pd&#39;, &#39;111Cd&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">askeylist</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">rat</span><span class="o">.</span><span class="n">numerator</span> <span class="k">for</span> <span class="n">rat</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">cache</span>
    <span class="k">def</span> <span class="nf">denominators</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="o">-&gt;</span> <span class="n">IsopyKeyList</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an isopy list containing the numerators for each ration in the sequence.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; RatioKeyList([&#39;99ru/108Pd&#39;, &#39;105pd/108Pd&#39;, &#39;111cd/108Pd&#39;]).numerators</span>
<span class="sd">        (&#39;108Pd&#39;, &#39;108Pd&#39;, &#39;108Pd&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">keylist</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">rat</span><span class="o">.</span><span class="n">denominator</span> <span class="k">for</span> <span class="n">rat</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">cache</span>
    <span class="k">def</span> <span class="nf">common_denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IsopyKeyString</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The common demoninator of all ratios in the sequence.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        NoCommonDenominator</span>
<span class="sd">            Raised if there is no common denominator in the sequence</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; RatioKeyList([&#39;99ru/108Pd&#39;, &#39;105pd/108Pd&#39;, &#39;111cd/108Pd&#39;]).common_denominator</span>
<span class="sd">        &#39;108Pd&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">l</span><span class="o">:=</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominators</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoCommomDenominator</span><span class="p">(</span><span class="s1">&#39;RatioKeyList is empty&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominators</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoCommomDenominator</span><span class="p">(</span><span class="s1">&#39;RatioKeyList does not have a common denominator&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">cache</span>
    <span class="k">def</span> <span class="nf">has_common_denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ``True`` if all the ratios in the sequence as a common denominator otherwise ``False``.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; RatioKeyList([&#39;99ru/108Pd&#39;, &#39;105pd/108Pd&#39;, &#39;111cd/108Pd&#39;]).has_common_denominator</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; RatioKeyList([&#39;99ru/108Pd&#39;, &#39;105pd/108Pd&#39;, &#39;111cd/108Pd&#39;]).has_common_denominator</span>
<span class="sd">        False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominators</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span>

<div class="viewcode-block" id="RatioKeyList.filter"><a class="viewcode-back" href="../../refpages/Lists/isopy.RatioKeyList.html#isopy.RatioKeyList.filter">[docs]</a>    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_eq</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">key_neq</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">numerator_and_denominator_kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a new key string list containing only the key strings that satisfies the specified</span>
<span class="sd">        filters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key_eq : str, Sequence[str], Optional</span>
<span class="sd">           Only key strings equal to/found in *key_eq* pass this filter.</span>
<span class="sd">        key_neq : str, Sequence[str], Optional</span>
<span class="sd">           Only key strings not equal to/found in *key_neq* pass this filter.</span>
<span class="sd">        mass_number_and_element_symbol_kwargs : str, Sequence[str], Optional</span>
<span class="sd">            Filter based on the numerator and denominator key strings of the ratio. Prefix</span>
<span class="sd">            numerator filters with ``numerator_`` and denominator</span>
<span class="sd">            filters with ``denominator_``.</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : RatioKeyList</span>
<span class="sd">            Key strings in the sequence that satisfy the specified filters</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; keylist = RatioKeyList([&#39;99ru/108Pd&#39;, &#39;105pd/108Pd&#39;, &#39;111cd/108Pd&#39;])</span>
<span class="sd">        &gt;&gt;&gt; keylist.filter(key_eq=[&#39;105pd/108Pd&#39;,&#39;107ag/108Pd&#39;, &#39;111cd/108Pd&#39;])</span>
<span class="sd">        (&#39;105Pd/108Pd&#39;, &#39;111Cd/108Pd&#39;)</span>
<span class="sd">        &gt;&gt;&gt; keylist.filter(key_neq=&#39;111cd/108Pd&#39;)</span>
<span class="sd">        (&#39;99Ru/108Pd&#39;, &#39;105Pd/108Pd&#39;)</span>
<span class="sd">        &gt;&gt;&gt; keylist.filter(numerator_isotope_symbol_key_eq = [&#39;pd&#39;, &#39;ag&#39;, &#39;cd&#39;])</span>
<span class="sd">        (&#39;105Pd/108Pd&#39;, &#39;111Cd/108Pd&#39;)</span>
<span class="sd">        &gt;&gt;&gt; keylist.filter(numerator_mass_number_key_lt = 100)</span>
<span class="sd">        (&#39;99Ru/108Pd&#39;, &#39;105Pd/108Pd&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="n">parse_keyfilters</span><span class="p">(</span><span class="n">key_eq</span><span class="o">=</span><span class="n">key_eq</span><span class="p">,</span> <span class="n">key_neq</span><span class="o">=</span><span class="n">key_neq</span><span class="p">,</span>
                                   <span class="o">**</span><span class="n">numerator_and_denominator_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">_filter</span><span class="p">(</span><span class="o">**</span><span class="n">filters</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="GeneralKeyList"><a class="viewcode-back" href="../../refpages/Lists/isopy.GeneralKeyList.html#isopy.GeneralKeyList">[docs]</a><span class="k">class</span> <span class="nc">GeneralKeyList</span><span class="p">(</span><span class="n">GeneralFlavour</span><span class="p">,</span> <span class="n">IsopyKeyList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A tuple consisting exclusively of :class:`GeneralKeyList` items.</span>

<span class="sd">    Behaves just like, and contains all the methods, that a normal tuple does unless otherwise noted.</span>
<span class="sd">    Only methods that behave differently from a normal python tuples are documented below.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    keys : str, Sequence[str]</span>
<span class="sd">        A string or sequence of strings that can be converted to the correct key string type.</span>
<span class="sd">    skip_duplicates : bool, Default = True</span>
<span class="sd">        If ``True`` all duplicate items will be removed from the sequence.</span>
<span class="sd">    allow_duplicates : bool, Default  = True</span>
<span class="sd">        If ``False`` a ListDuplicateError will be raised if the sequence contains any duplicate items.</span>
<span class="sd">    allow_reformatting : bool, Default = True</span>
<span class="sd">        If ``True`` the string will be reformatted to the correct format. If ``False`` an exception</span>
<span class="sd">        will be raised it the string is not correctly formatted.</span>


<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ListDuplicateError</span>
<span class="sd">        Raised when a string already exist in the sequence and ``allow_duplicates = False``</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; GeneralKeyList([harry, &#39;ron&#39;, &#39;hermione&#39;])</span>
<span class="sd">    (&#39;harry&#39;, &#39;ron&#39;, &#39;hermione&#39;)</span>
<span class="sd">    &gt;&gt;&gt; GeneralKeyList(harry, &#39;ron&#39; ,&#39;hermione&#39;)</span>
<span class="sd">    (&#39;harry&#39;, &#39;ron&#39;, &#39;hermione&#39;)</span>
<span class="sd">    &gt;&gt;&gt; GeneralKeyList(harry, [&#39;ron&#39; , &#39;hermione&#39;])</span>
<span class="sd">    (&#39;harry&#39;, &#39;ron&#39;, &#39;hermione&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="GeneralKeyList.filter"><a class="viewcode-back" href="../../refpages/Lists/isopy.GeneralKeyList.html#isopy.GeneralKeyList.filter">[docs]</a>    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_eq</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">key_neq</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a new key string list containing only the key strings that satisfies the specified</span>
<span class="sd">        filters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key_eq : str, Sequence[str], Optional</span>
<span class="sd">           Only key strings equal to/found in *key_eq* pass this filter.</span>
<span class="sd">        key_neq : str, Sequence[str], Optional</span>
<span class="sd">           Only key strings not equal to/found in *key_neq* pass this filter.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : GeneralKeyList</span>
<span class="sd">            Key strings in the sequence that satisfy the specified filters</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; keylist = GeneralKeyList([&#39;harry&#39;, &#39;ron&#39;, &#39;hermione&#39;])</span>
<span class="sd">        &gt;&gt;&gt; keylist.filter(key_eq=[&#39;harry&#39;, &#39;ron&#39;, &#39;neville&#39;])</span>
<span class="sd">        (&#39;harry&#39;, &#39;ron&#39;)</span>
<span class="sd">        &gt;&gt;&gt; keylist.filter(key_neq=&#39;harry&#39;)</span>
<span class="sd">        (&#39;ron&#39;, &#39;hermione&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filters</span> <span class="o">=</span> <span class="n">parse_keyfilters</span><span class="p">(</span><span class="n">key_eq</span><span class="o">=</span><span class="n">key_eq</span><span class="p">,</span> <span class="n">key_neq</span><span class="o">=</span><span class="n">key_neq</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">_filter</span><span class="p">(</span><span class="o">**</span><span class="n">filters</span><span class="p">))</span></div></div>

<span class="c1">############</span>
<span class="c1">### Dict ###</span>
<span class="c1">############</span>

<div class="viewcode-block" id="IsopyDict"><a class="viewcode-back" href="../../refpages/Dicts/isopy.IsopyDict.html#isopy.IsopyDict">[docs]</a><span class="k">class</span> <span class="nc">IsopyDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dictionary where each value is stored by a isopy keystring key.</span>

<span class="sd">    Behaves just like, and contains all the methods, that a normal dictionary does unless otherwise</span>
<span class="sd">    noted. Only methods that behave differently from a normal dictionary are documented below.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    args : dict[str, Any], Optional</span>
<span class="sd">        Dictionary(ies) where each key can be converted to a keystring.</span>
<span class="sd">    default_value : Any, Default = None</span>
<span class="sd">        The default value for a key not present in the dictionary. Should ideally be the same type as</span>
<span class="sd">        the value stored in the dictionary</span>
<span class="sd">    readonly : bool, Default = False</span>
<span class="sd">        If ``True`` the dictionary cannot be edited. This attribute is not inherited by child</span>
<span class="sd">        dictionaries.</span>
<span class="sd">    kwargs : Any, Optional</span>
<span class="sd">        Key, Value pairs to be included in the dictionary</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; isopy.IsopyDict({&#39;Pd108&#39;: 108, &#39;105Pd&#39;: 105, &#39;pd&#39;: 46})</span>
<span class="sd">    IsopyDict(default_value = None, readonly = False,</span>
<span class="sd">    {&quot;108Pd&quot;: 108</span>
<span class="sd">    &quot;105Pd&quot;: 105</span>
<span class="sd">    &quot;Pd&quot;: 46})</span>

<span class="sd">    &gt;&gt;&gt; isopy.IsopyDict(Pd108 = 108, pd105= 105, pd=46, default_value=0)</span>
<span class="sd">    IsopyDict(default_value = 0, readonly = False,</span>
<span class="sd">    {&quot;108Pd&quot;: 108</span>
<span class="sd">    &quot;105Pd&quot;: 105</span>
<span class="sd">    &quot;Pd&quot;: 46})</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(default_value = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">default_value</span><span class="si">}</span><span class="s1">, readonly = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">readonly</span><span class="si">}</span><span class="s1">,</span><span class="se">\n{{</span><span class="si">{</span><span class="n">items</span><span class="si">}</span><span class="se">}}</span><span class="s1">)&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">default_value</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">readonly</span> <span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IsopyDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_readonly</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_value</span> <span class="o">=</span> <span class="n">default_value</span>

        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;arg must be dict&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_readonly</span> <span class="o">=</span> <span class="n">readonly</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readonly</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;this dictionary is readonly. Make a copy to make changes&#39;</span><span class="p">)</span>

        <span class="n">key</span> <span class="o">=</span> <span class="n">askeystring</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IsopyDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readonly</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;this dictionary is readonly. Make a copy to make changes&#39;</span><span class="p">)</span>

        <span class="n">key</span> <span class="o">=</span> <span class="n">askeystring</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IsopyDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">askeystring</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">IsopyDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">askeystring</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">IsopyDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">readonly</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ``True`` if the dictionary cannot be edited otherwise ``False``.</span>

<span class="sd">        This attribute is **not** inherited by derivative dictionaries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readonly</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The default value, if given, for keys not present in the dictionary using the ``get()`` method.</span>

<span class="sd">        This attribute in inherited by derivative dictionaries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_value</span>

<div class="viewcode-block" id="IsopyDict.get"><a class="viewcode-back" href="../../refpages/Dicts/isopy.IsopyDict.html#isopy.IsopyDict.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">NotGiven</span><span class="p">,</span> <span class="o">**</span><span class="n">key_filters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the the value for *key* if present in the dictionary. Otherwise *default* is</span>
<span class="sd">        returned. If *key* is a sequence of keys a dictionary is returned. If *default* is</span>
<span class="sd">        not given the default value of the dictionary is used.</span>

<span class="sd">        *key_filters* will only be processed if *key* is not given. A new dictionary will be returned</span>
<span class="sd">        containing only they keys in the current dictonrary that passes these filters.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; reference = isopy.IsopyDict({&#39;108Pd&#39;: 100, &#39;105Pd&#39;: 20, &#39;104Pd&#39;: 150})</span>
<span class="sd">        &gt;&gt;&gt; reference.get(&#39;pd108&#39;)</span>
<span class="sd">        100</span>
<span class="sd">        &gt;&gt;&gt; reference.get(&#39;104Pd/105Pd&#39;)</span>
<span class="sd">        None</span>
<span class="sd">        &gt;&gt;&gt; reference.get(&#39;104Pd/105Pd&#39;, default=np.nan)</span>
<span class="sd">        nan</span>
<span class="sd">        &gt;&gt;&gt; reference.get(mass_number_lt = 106)</span>
<span class="sd">        {IsotopeKeyString(&#39;105Pd&#39;): 20, IsotopeKeyString(&#39;104Pd&#39;): 150}</span>


<span class="sd">        &gt;&gt;&gt; reference = isopy.IsopyDict({&#39;108Pd&#39;: 100, &#39;105Pd&#39;: 20, &#39;104Pd&#39;: 150}, default_value=np.nan)</span>
<span class="sd">        &gt;&gt;&gt; reference.get(&#39;104Pd/105Pd&#39;)</span>
<span class="sd">        nan</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="n">NotGiven</span><span class="p">:</span>
            <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_value</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">askeystring</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">IsopyDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">default</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span><span class="p">},</span>
                                  <span class="n">default_value</span><span class="o">=</span><span class="n">default</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key_filters</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">key_filters</span> <span class="o">=</span> <span class="n">parse_keyfilters</span><span class="p">(</span><span class="o">**</span><span class="n">key_filters</span><span class="p">)</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">_filter</span><span class="p">(</span><span class="o">**</span><span class="n">key_filters</span><span class="p">)]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">key_filters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;a key or at least one key filter must be given&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;key type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="si">}</span><span class="s1"> not understood&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the dictionary with the key/value pairs from other, overwriting existing keys.</span>

<span class="sd">        A TypeError is raised if the dictionary is readonly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readonly</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;this dictionary is readonly. Make a copy to make changes&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;other must be a dict&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">other</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">NotGiven</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If *key* is in the dictionary, remove it and return its value, else return *default*. If</span>
<span class="sd">        *default* is not given the default value of hte dictionary is used.</span>

<span class="sd">        A TypeError is raised if the dictionary is readonly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readonly</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;this dictionary is readonly. Make a copy to make changes&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="n">NotGiven</span><span class="p">:</span>
            <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_value</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">askeystring</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">IsopyDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotGiven</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No default value given&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">NotGiven</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If *key* in dictionary, return its value. If not, insert *key* with the default value and</span>
<span class="sd">        the default value. If *default* is not given the default value of the dictionary is used.</span>

<span class="sd">        A TypeError is raised if the dictionary is readonly and *key* is not in the dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readonly</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;this dictionary is readonly. Make a copy to make changes&#39;</span><span class="p">)</span>

        <span class="n">key</span> <span class="o">=</span> <span class="n">askeystring</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotGiven</span><span class="p">:</span>
            <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_value</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotGiven</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No default value given&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<div class="viewcode-block" id="IsopyDict.copy"><a class="viewcode-back" href="../../refpages/Dicts/isopy.IsopyDict.html#isopy.IsopyDict.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a copy of the current dictionary.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_value</span><span class="p">,</span> <span class="n">get_divide</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_divide</span><span class="p">)</span></div>

<div class="viewcode-block" id="IsopyDict.clear"><a class="viewcode-back" href="../../refpages/Dicts/isopy.IsopyDict.html#isopy.IsopyDict.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes all items from the dictionary.</span>

<span class="sd">        A TypeError is raised if the dictionary is readonly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readonly</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;this dictionary is readonly. Make a copy to make changes&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IsopyDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="ScalarDict"><a class="viewcode-back" href="../../refpages/Dicts/isopy.ScalarDict.html#isopy.ScalarDict">[docs]</a><span class="k">class</span> <span class="nc">ScalarDict</span><span class="p">(</span><span class="n">IsopyDict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dictionary where each value is stored as a numpy float by a isopy keystring key.</span>

<span class="sd">    Behaves just like, and contains all the methods, that a normal dictionary does unless otherwise</span>
<span class="sd">    noted. Only methods that behave differently from a normal dictionary are documented below.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *args : dict[str, scalar], Optional</span>
<span class="sd">        Dictionary(ies) where each key can be converted to a keystring.</span>
<span class="sd">    default_value : scalar, Default = np.nan</span>
<span class="sd">        The default value for a key not present in the dictionary. Should ideally be the same type as</span>
<span class="sd">        the value stored in the dictionary</span>
<span class="sd">    readonly : bool, Default = True</span>
<span class="sd">        If ``True`` the dictionary cannot be edited. This attribute is not inherited by child</span>
<span class="sd">        dictionaries.</span>
<span class="sd">    kwargs : scalar, Optional</span>
<span class="sd">        Key, Value pairs to be included in the dictionary</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; isopy.ScalarDict({&#39;Pd108&#39;: 108, &#39;105Pd&#39;: 105, &#39;pd&#39;: 46})</span>
<span class="sd">    ScalarDict(default_value = nan, readonly = False,</span>
<span class="sd">    {&quot;108Pd&quot;: 108.0</span>
<span class="sd">    &quot;105Pd&quot;: 105.0</span>
<span class="sd">    &quot;Pd&quot;: 46.0})</span>

<span class="sd">    &gt;&gt;&gt; isopy.ScalarDict(Pd108 = 108, pd105= 105, pd=46, default_value=0)</span>
<span class="sd">    ScalarDict(default_value = 0, readonly = False,</span>
<span class="sd">    {&quot;108Pd&quot;: 108.0</span>
<span class="sd">    &quot;105Pd&quot;: 105.0</span>
<span class="sd">    &quot;Pd&quot;: 46.0})</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="n">nan</span><span class="p">,</span>
                 <span class="n">readonly</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ScalarDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="n">default_value</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="n">readonly</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float_</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;unable to convert value for key &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot; to float&#39;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ScalarDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="ScalarDict.get"><a class="viewcode-back" href="../../refpages/Dicts/isopy.ScalarDict.html#isopy.ScalarDict.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">default</span> <span class="o">=</span> <span class="n">NotGiven</span><span class="p">,</span>
            <span class="o">**</span><span class="n">key_filters</span><span class="p">:</span> <span class="n">Any</span>
            <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the the value for *key* if present in the dictionary. If *key* not in the dictonary</span>
<span class="sd">        and *key* is a ratio key string the numerator value divided by the denominator value will</span>
<span class="sd">        be returned if both key strings are present in the dictionary. Otherwise *default* is</span>
<span class="sd">        returned. If *key* is a sequence of keys a dictionary is returned. If *default* is</span>
<span class="sd">        not given the default value of the dictionary is used.</span>

<span class="sd">        *key_filters* will only be processed if *key* is not given. A new dictionary will be returned</span>
<span class="sd">        containing only they keys in the current dictonrary that passes these filters.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; reference = ScalarDict({&#39;108Pd&#39;: 100, &#39;105Pd&#39;: 20, &#39;104Pd&#39;: 150})</span>
<span class="sd">        &gt;&gt;&gt; reference.get(&#39;pd108&#39;)</span>
<span class="sd">        100</span>
<span class="sd">        &gt;&gt;&gt; reference.get(&#39;104Pd/105Pd&#39;)</span>
<span class="sd">        7.5</span>
<span class="sd">        &gt;&gt;&gt; reference.get(&#39;110Pd/105Pd&#39;)</span>
<span class="sd">        nan</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="n">NotGiven</span><span class="p">:</span>
            <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_value</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">askeystring</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">IsopyDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="n">RatioKeyString</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">IsopyDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">numerator</span><span class="p">)</span>
                        <span class="n">result</span> <span class="o">/=</span> <span class="nb">super</span><span class="p">(</span><span class="n">IsopyDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">denominator</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">result</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">pass</span>

                <span class="k">return</span> <span class="n">default</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">ScalarDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="o">**</span><span class="n">key_filters</span><span class="p">)</span></div></div>

<span class="k">def</span> <span class="nf">parse_keyfilters</span><span class="p">(</span><span class="o">**</span><span class="n">filters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parses key filters into a format that is accepted by KeyString._filter. Allows</span>
<span class="sd">    nesting of filter arguments for Isotope and RatioKeyString&#39;s.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Make sure these are lists</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;key_eq&#39;</span><span class="p">,</span> <span class="s1">&#39;key_neq&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="o">:=</span><span class="n">filters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">filters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">,)</span>

    <span class="c1">#For isotope keys</span>
    <span class="n">mass_number</span> <span class="o">=</span> <span class="n">_split_filter</span><span class="p">(</span><span class="s1">&#39;mass_number&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mass_number</span><span class="p">:</span>
        <span class="n">filters</span><span class="p">[</span><span class="s1">&#39;mass_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_keyfilters</span><span class="p">(</span><span class="o">**</span><span class="n">mass_number</span><span class="p">)</span>

    <span class="n">element_symbol</span> <span class="o">=</span> <span class="n">_split_filter</span><span class="p">(</span><span class="s1">&#39;element_symbol&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">element_symbol</span><span class="p">:</span>
        <span class="n">filters</span><span class="p">[</span><span class="s1">&#39;element_symbol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_keyfilters</span><span class="p">(</span><span class="o">**</span><span class="n">element_symbol</span><span class="p">)</span>

    <span class="c1">#For ratiokeys</span>
    <span class="n">numerator</span> <span class="o">=</span> <span class="n">_split_filter</span><span class="p">(</span><span class="s1">&#39;numerator&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">numerator</span><span class="p">:</span>
        <span class="n">filters</span><span class="p">[</span><span class="s1">&#39;numerator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_keyfilters</span><span class="p">(</span><span class="o">**</span><span class="n">numerator</span><span class="p">)</span>

    <span class="n">denominator</span> <span class="o">=</span> <span class="n">_split_filter</span><span class="p">(</span><span class="s1">&#39;denominator&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">denominator</span><span class="p">:</span>
        <span class="n">filters</span><span class="p">[</span><span class="s1">&#39;denominator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_keyfilters</span><span class="p">(</span><span class="o">**</span><span class="n">denominator</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">filters</span>


<span class="k">def</span> <span class="nf">_split_filter</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">filters</span><span class="p">):</span>
    <span class="c1">#Seperates out filters with a specific prefix</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">prefix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span> <span class="n">prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">_&#39;</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">filters</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="c1">#avoids getting errors</span>
            <span class="n">out</span><span class="p">[</span><span class="s1">&#39;key_eq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
            <span class="nb">filter</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;neq&#39;</span><span class="p">,</span> <span class="s1">&#39;lt&#39;</span><span class="p">,</span> <span class="s1">&#39;le&#39;</span><span class="p">,</span> <span class="s1">&#39;ge&#39;</span><span class="p">,</span> <span class="s1">&#39;gt&#39;</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;key_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">out</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">filter</span>
    <span class="k">return</span> <span class="n">out</span>


<span class="c1">#############</span>
<span class="c1">### Array ###</span>
<span class="c1">#############</span>
<span class="k">class</span> <span class="nc">IsopyArray</span><span class="p">(</span><span class="n">IsopyFlavour</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_text</span><span class="p">(</span><span class="o">**</span><span class="n">ARRAY_REPR</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;,</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)]))</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(</span><span class="se">\n</span><span class="si">{</span><span class="n">out</span><span class="si">}</span><span class="s1">,</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="si">!r}</span><span class="s1">)&#39;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_text</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__array_ufunc__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ufunc</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">!=</span> <span class="s1">&#39;__call__&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;only the ufunc method &quot;__call__&quot; is supported by isopy arrays&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ufunc</span> <span class="ow">in</span> <span class="n">reimplmented_functions</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">reimplmented_functions</span><span class="p">[</span><span class="n">ufunc</span><span class="p">](</span><span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">array_function</span><span class="p">(</span><span class="n">ufunc</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__array_function__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">types</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">reimplmented_functions</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">reimplmented_functions</span><span class="p">[</span><span class="n">func</span><span class="p">](</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Incase input arguments were given as keyword arguments</span>
            <span class="n">fargs</span><span class="p">,</span> <span class="n">nin</span> <span class="o">=</span> <span class="n">_function_signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fargs</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nin</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">fargs</span><span class="p">,</span> <span class="n">args</span><span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">fargs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nin</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="c1">#I dont think this would ever happen as it would be caught by the</span>
                    <span class="c1">#array function dispatcher.</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&quot; expects </span><span class="si">{</span><span class="n">nin</span><span class="si">}</span><span class="s1"> input arguments but only got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1">#Some scipy stat functions sets</span>
            <span class="k">if</span> <span class="s1">&#39;axis&#39;</span> <span class="ow">in</span> <span class="n">fargs</span> <span class="ow">and</span> <span class="s1">&#39;axis&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;axis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NotGiven</span>

            <span class="k">return</span> <span class="n">array_function</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">void</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__view_void</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__view_ndarray</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">ndarray</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="n">nan</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the values of column *key* if present in the array. Otherwise an numpy array</span>
<span class="sd">        filled with *default* is returned with the same shape as a column in the array. An</span>
<span class="sd">        exception will be raised if *default* cannot be broadcast to the correct shape.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keystring</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">key_filter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a copy of the array. If *key_filters* are given then the returned array only</span>
<span class="sd">        contains the columns that satisfy the *key_filter* filters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key_filter</span><span class="p">:</span>
            <span class="n">out_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">**</span><span class="n">key_filter</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">out_keys</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">IsopyArray</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">denominator</span><span class="p">,</span> <span class="n">remove_denominator</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Divide all values in the array by the *denominator* column and return a :class:`RatioArray`.</span>
<span class="sd">        If *remove_denominator* is ``True`` the denominator/denominator ratio is not included in</span>
<span class="sd">        the returned array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">denominator</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;key &quot;</span><span class="si">{</span><span class="n">denominator</span><span class="si">}</span><span class="s1">&quot; not found in keys of the array&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">remove_denominator</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">keys</span> <span class="o">-</span> <span class="n">denominator</span>

        <span class="k">return</span> <span class="n">RatioArray</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="p">[</span><span class="n">denominator</span><span class="p">],</span> <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="o">/</span><span class="n">denominator</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A key string list containing the name of each column in the array.</span>

<span class="sd">        ``array.keys()`` is also allowed as calling a key string list will just return a</span>
<span class="sd">        pointer to itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ncols</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Number of columns in the array&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nrows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Number of rows in the array. If the array is 0-dimensional ``-1`` is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>

    <span class="k">def</span> <span class="nf">to_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">include_row</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">include_dtype</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">nrows</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">vformat</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a string containing the contents of the array.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        delimiter : str, Default = &#39;, &#39;</span>
<span class="sd">            String used to separate columns in each row.</span>
<span class="sd">        include_row : bool, Default = False</span>
<span class="sd">            If ``True`` a column containing the row index is included. *None* Is given as the</span>
<span class="sd">            row index for 0-dimensional arrays.</span>
<span class="sd">        include_dtype : bool, Default = False</span>
<span class="sd">            If ``True`` the column data type is included in the first row next to the column name.</span>
<span class="sd">        nrows : int, Optional</span>
<span class="sd">            The number of rows to show.</span>
<span class="sd">        vformat : str, Optional</span>
<span class="sd">            Format string for different kinds of data. The key denoted the data kind. Common data</span>
<span class="sd">            kind strings ara ``&quot;f&quot;`` for floats, ``&quot;i&quot;`` for integers and ``&quot;S&quot;`` for strings.</span>
<span class="sd">            Dictionary containing a format string for different kinds of data.  Most common ``&quot;f&quot;``.</span>
<span class="sd">            Default format string for each data type is ``&#39;{}&#39;``. A list of all avaliable data kinds</span>
<span class="sd">            is avaliable `here &lt;https://numpy.org/doc/stable/reference/arrays.interface.html&gt;`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">include_row</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;(row)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;None&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;(row)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">include_dtype</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">val</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span><span class="si">}{</span><span class="n">val</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span><span class="si">}</span><span class="s1">)&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sdict</span><span class="p">[</span><span class="n">title</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">vformat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">])]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sdict</span><span class="p">[</span><span class="n">title</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">vformat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">nrows</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">nrows</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">nrows</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">first</span> <span class="o">=</span> <span class="n">nrows</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="p">(</span><span class="n">nrows</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">nrows</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">sdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">sdict</span><span class="p">[</span><span class="n">title</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[:</span><span class="n">first</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;...&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">value</span><span class="p">[</span><span class="n">last</span><span class="p">:]</span>
            <span class="n">nrows</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nrows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>

        <span class="n">flen</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sdict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">flen</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sdict</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">flen</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span> <span class="n">flen</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;{:&lt;</span><span class="si">{}</span><span class="s1">}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">flen</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sdict</span><span class="o">.</span><span class="n">keys</span><span class="p">()]),</span>
                                   <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;{:&lt;</span><span class="si">{}</span><span class="s1">}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sdict</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">flen</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sdict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                                             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list containing the data in the array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">list</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dictionary containing the data in the array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">):</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>

    <span class="k">def</span> <span class="nf">to_clipboard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">include_row</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                     <span class="n">include_dtype</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">vformat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                     <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy the string returned from ``array.pformat(*args, **kwargs)`` to the clipboard.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_text</span><span class="p">(</span><span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">include_row</span><span class="o">=</span><span class="n">include_row</span><span class="p">,</span> <span class="n">include_dtype</span><span class="o">=</span><span class="n">include_dtype</span><span class="p">,</span> <span class="n">vformat</span><span class="o">=</span><span class="n">vformat</span><span class="p">)</span>
        <span class="n">pyperclip</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">string</span>

    <span class="k">def</span> <span class="nf">to_ndarray</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a copy of the array as a normal numpy ndarray&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">ndarray</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">comments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save array to a cv file. If *filename* already exits it will be overwritten. If *comments*</span>
<span class="sd">        are given they will be included before the array data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">isopy</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="n">comments</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_xlsx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sheetname</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">comments</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">append</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save array to a excel workbook. If *sheetname* is not given the array will be saved as</span>
<span class="sd">        &quot;sheet1&quot;. If *filename* exists and *append* is ``True`` the sheet will be added to the</span>
<span class="sd">        existing workbook. Otherwie the existing file will be overwritten. If *comments* are given</span>
<span class="sd">        they will be included before the array data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sheetname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sheetname</span> <span class="o">=</span> <span class="s1">&#39;sheet1&#39;</span>

        <span class="c1"># TODO if sheetname is given and file exits open it and add the sheet, overwrite if nessecary</span>
        <span class="n">isopy</span><span class="o">.</span><span class="n">write_xlsx</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="n">comments</span><span class="p">,</span>  <span class="o">**</span><span class="p">{</span><span class="n">sheetname</span><span class="p">:</span> <span class="bp">self</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">to_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert array to a pandas dataframe. An exception is raised if pandas is not installed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pandas</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Pandas is not installed&#39;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_xlsx</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sheetname</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span> <span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load array from *sheetname* in  workbook with *filename* and return as an array of this type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_Flavour__array</span><span class="p">(</span><span class="n">isopy</span><span class="o">.</span><span class="n">read_xlsx</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sheetname</span><span class="p">))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_csv</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load array from csv file with *filename* and return as an array of this type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_Flavour__array</span><span class="p">(</span><span class="n">isopy</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>


<div class="viewcode-block" id="MassArray"><a class="viewcode-back" href="../../refpages/Arrays/isopy.MassArray.html#isopy.MassArray">[docs]</a><span class="k">class</span> <span class="nc">MassArray</span><span class="p">(</span><span class="n">IsopyArray</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An array where data is stored in named columns with :class:`MassKeyString` keys.</span>

<span class="sd">    This is a custom subclass of a `structured numpy array &lt;https://docs.scipy.org/doc/numpy/user/basics.rec.html&gt;`_</span>
<span class="sd">    and therefore contains all the methods and attributes that a normal numpy ndarray does. However, these</span>
<span class="sd">    may **not** work as expected and caution is advised when using attributes/methods not described below or in the</span>
<span class="sd">    tutorial.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    values : dict, list, numpy_array, isopy_array</span>
<span class="sd">        Values can be a dictionary containing values or a sequence of values. A sequence containing</span>
<span class="sd">        values or sequences of values. A structured numpy array or a subclass thereof (e.g. pandas</span>
<span class="sd">        dataframe).</span>
<span class="sd">    keys : Sequence[str], Optional</span>
<span class="sd">        Name of each column in the array. Does not need to be given if *values* is a dictionary</span>
<span class="sd">        or structured numpy array or if *dtype* is a ``np.dtype`` containing named columns.</span>
<span class="sd">    ndim : {-1, 0, 1}, Optional</span>
<span class="sd">        Number of dimensions of the returned array. If ``-1`` then the final array will be</span>
<span class="sd">        0-dimensional if it has a size of 1 otherwise it will be 1-dimensional.</span>
<span class="sd">    dtype : numpy_dtype, Sequence[numpy_dtype], dict[str, numpy_dtype], Optional</span>
<span class="sd">        Any data type accepted by numpy. Can also be a sequence of data types in which case the</span>
<span class="sd">        first data type in the sequence for which a conversion is possible is used. Data types</span>
<span class="sd">        for individual columns can be specified by a dictionary mapping the column name to the</span>
<span class="sd">        data type. If not given the data type is inferred from *values* if they already</span>
<span class="sd">        have a numpy data type. Otherwise values are converted to ``np.float64`` if possible. If</span>
<span class="sd">        conversion fails the default data type from ``np.array(values[column])`` is used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MassNdarray</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="n">ndim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span></div>


<div class="viewcode-block" id="ElementArray"><a class="viewcode-back" href="../../refpages/Arrays/isopy.ElementArray.html#isopy.ElementArray">[docs]</a><span class="k">class</span> <span class="nc">ElementArray</span><span class="p">(</span><span class="n">IsopyArray</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An array where data is stored in named columns with :class:`ElementKeyString` keys.</span>

<span class="sd">    This is a custom subclass of a `structured numpy array &lt;https://docs.scipy.org/doc/numpy/user/basics.rec.html&gt;`_</span>
<span class="sd">    and therefore contains all the methods and attributes that a normal numpy ndarray does. However, these</span>
<span class="sd">    may **not** work as expected and caution is advised when using attributes/methods not described below or in the</span>
<span class="sd">    tutorial.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    values : dict, list, numpy_array, isopy_array</span>
<span class="sd">        Values can be a dictionary containing values or a sequence of values. A sequence containing</span>
<span class="sd">        values or sequences of values. A structured numpy array or a subclass thereof (e.g. pandas</span>
<span class="sd">        dataframe).</span>
<span class="sd">    keys : Sequence[str], Optional</span>
<span class="sd">        Name of each column in the array. Does not need to be given if *values* is a dictionary</span>
<span class="sd">        or structured numpy array or if *dtype* is a ``np.dtype`` containing named columns.</span>
<span class="sd">    ndim : {-1, 0, 1}, Optional</span>
<span class="sd">        Number of dimensions of the returned array. If ``-1`` then the final array will be</span>
<span class="sd">        0-dimensional if it has a size of 1 otherwise it will be 1-dimensional.</span>
<span class="sd">    dtype : numpy_dtype, Sequence[numpy_dtype], dict[str, numpy_dtype], Optional</span>
<span class="sd">        Any data type accepted by numpy. Can also be a sequence of data types in which case the</span>
<span class="sd">        first data type in the sequence for which a conversion is possible is used. Data types</span>
<span class="sd">        for individual columns can be specified by a dictionary mapping the column name to the</span>
<span class="sd">        data type. If not given the data type is inferred from *values* if they already</span>
<span class="sd">        have a numpy data type. Otherwise values are converted to ``np.float64`` if possible. If</span>
<span class="sd">        conversion fails the default data type from ``np.array(values[column])`` is used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ElementNdarray</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="n">ndim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsotopeArray"><a class="viewcode-back" href="../../refpages/Arrays/isopy.IsotopeArray.html#isopy.IsotopeArray">[docs]</a><span class="k">class</span> <span class="nc">IsotopeArray</span><span class="p">(</span><span class="n">IsopyArray</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An array where data is stored in named columns with :class:`IsotopeKeyString` keys.</span>

<span class="sd">    This is a custom subclass of a `structured numpy array &lt;https://docs.scipy.org/doc/numpy/user/basics.rec.html&gt;`_</span>
<span class="sd">    and therefore contains all the methods and attributes that a normal numpy ndarray does. However, these</span>
<span class="sd">    may **not** work as expected and caution is advised when using attributes/methods not described below or in the</span>
<span class="sd">    tutorial.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    values : dict, list, numpy_array, isopy_array</span>
<span class="sd">        Values can be a dictionary containing values or a sequence of values. A sequence containing</span>
<span class="sd">        values or sequences of values. A structured numpy array or a subclass thereof (e.g. pandas</span>
<span class="sd">        dataframe).</span>
<span class="sd">    keys : Sequence[str], Optional</span>
<span class="sd">        Name of each column in the array. Does not need to be given if *values* is a dictionary</span>
<span class="sd">        or structured numpy array or if *dtype* is a ``np.dtype`` containing named columns.</span>
<span class="sd">    ndim : {-1, 0, 1}, Optional</span>
<span class="sd">        Number of dimensions of the returned array. If ``-1`` then the final array will be</span>
<span class="sd">        0-dimensional if it has a size of 1 otherwise it will be 1-dimensional.</span>
<span class="sd">    dtype : numpy_dtype, Sequence[numpy_dtype], dict[str, numpy_dtype], Optional</span>
<span class="sd">        Any data type accepted by numpy. Can also be a sequence of data types in which case the</span>
<span class="sd">        first data type in the sequence for which a conversion is possible is used. Data types</span>
<span class="sd">        for individual columns can be specified by a dictionary mapping the column name to the</span>
<span class="sd">        data type. If not given the data type is inferred from *values* if they already</span>
<span class="sd">        have a numpy data type. Otherwise values are converted to ``np.float64`` if possible. If</span>
<span class="sd">        conversion fails the default data type from ``np.array(values[column])`` is used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">IsotopeNdarray</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="n">ndim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span></div>


<div class="viewcode-block" id="RatioArray"><a class="viewcode-back" href="../../refpages/Arrays/isopy.RatioArray.html#isopy.RatioArray">[docs]</a><span class="k">class</span> <span class="nc">RatioArray</span><span class="p">(</span><span class="n">IsopyArray</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An array where data is stored in named columns with :class:`RatioKeyString` keys.</span>

<span class="sd">    This is a custom subclass of a `structured numpy array &lt;https://docs.scipy.org/doc/numpy/user/basics.rec.html&gt;`_</span>
<span class="sd">    and therefore contains all the methods and attributes that a normal numpy ndarray does. However, these</span>
<span class="sd">    may **not** work as expected and caution is advised when using attributes/methods not described below or in the</span>
<span class="sd">    tutorial.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    values : dict, list, numpy_array, isopy_array</span>
<span class="sd">        Values can be a dictionary containing values or a sequence of values. A sequence containing</span>
<span class="sd">        values or sequences of values. A structured numpy array or a subclass thereof (e.g. pandas</span>
<span class="sd">        dataframe).</span>
<span class="sd">    keys : Sequence[str], Optional</span>
<span class="sd">        Name of each column in the array. Does not need to be given if *values* is a dictionary</span>
<span class="sd">        or structured numpy array or if *dtype* is a ``np.dtype`` containing named columns.</span>
<span class="sd">    ndim : {-1, 0, 1}, Optional</span>
<span class="sd">        Number of dimensions of the returned array. If ``-1`` then the final array will be</span>
<span class="sd">        0-dimensional if it has a size of 1 otherwise it will be 1-dimensional.</span>
<span class="sd">    dtype : numpy_dtype, Sequence[numpy_dtype], dict[str, numpy_dtype], Optional</span>
<span class="sd">        Any data type accepted by numpy. Can also be a sequence of data types in which case the</span>
<span class="sd">        first data type in the sequence for which a conversion is possible is used. Data types</span>
<span class="sd">        for individual columns can be specified by a dictionary mapping the column name to the</span>
<span class="sd">        data type. If not given the data type is inferred from *values* if they already</span>
<span class="sd">        have a numpy data type. Otherwise values are converted to ``np.float64`` if possible. If</span>
<span class="sd">        conversion fails the default data type from ``np.array(values[column])`` is used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">RatioNdarray</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="n">ndim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

<div class="viewcode-block" id="RatioArray.deratio"><a class="viewcode-back" href="../../refpages/Arrays/isopy.RatioArray.html#isopy.RatioArray.deratio">[docs]</a>    <span class="k">def</span> <span class="nf">deratio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">denominator_value</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a array with the numerators and the common denominator as columns. Values for the</span>
<span class="sd">        numerators will be copied from the original array and the entire array will be multiplied by</span>
<span class="sd">        *denominator_value*.</span>

<span class="sd">        An exception is raised if the array does not contain a common denominator.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">denominator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">.</span><span class="n">common_denominator</span>
        <span class="n">numerators</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">.</span><span class="n">numerators</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">numerators</span><span class="o">.</span><span class="n">_Flavour__array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numerators</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">denominator</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="p">,</span> <span class="n">denominator</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span> <span class="o">*</span> <span class="n">denominator_value</span></div></div>


<div class="viewcode-block" id="GeneralArray"><a class="viewcode-back" href="../../refpages/Arrays/isopy.GeneralArray.html#isopy.GeneralArray">[docs]</a><span class="k">class</span> <span class="nc">GeneralArray</span><span class="p">(</span><span class="n">IsopyArray</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An array where data is stored in named columns with :class:`GeneralKeyString` keys.</span>

<span class="sd">        This is a custom subclass of a `structured numpy array &lt;https://docs.scipy.org/doc/numpy/user/basics.rec.html&gt;`</span>
<span class="sd">        and therefore contains all the methods and attributes that a normal numpy ndarray does. However, these</span>
<span class="sd">        may **not** work as expected and caution is advised when using attributes/methods not described below or in the</span>
<span class="sd">        tutorial.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        values : dict, list, numpy_array, isopy_array</span>
<span class="sd">            Values can be a dictionary containing values or a sequence of values. A sequence containing</span>
<span class="sd">            values or sequences of values. A structured numpy array or a subclass thereof (e.g. pandas</span>
<span class="sd">            dataframe).</span>
<span class="sd">        keys : Sequence[str], Optional</span>
<span class="sd">            Name of each column in the array. Does not need to be given if *values* is a dictionary</span>
<span class="sd">            or structured numpy array or if *dtype* is a ``np.dtype`` containing named columns.</span>
<span class="sd">        ndim : {-1, 0, 1}, Optional</span>
<span class="sd">            Number of dimensions of the returned array. If ``-1`` then the final array will be</span>
<span class="sd">            0-dimensional if it has a size of 1 otherwise it will be 1-dimensional.</span>
<span class="sd">        dtype : numpy_dtype, Sequence[numpy_dtype], dict[str, numpy_dtype], Optional</span>
<span class="sd">            Any data type accepted by numpy. Can also be a sequence of data types in which case the</span>
<span class="sd">            first data type in the sequence for which a conversion is possible is used. Data types</span>
<span class="sd">            for individual columns can be specified by a dictionary mapping the column name to the</span>
<span class="sd">            data type. If not given the data type is inferred from *values* if they already</span>
<span class="sd">            have a numpy data type. Otherwise values are converted to ``np.float64`` if possible. If</span>
<span class="sd">            conversion fails the default data type from ``np.array(values[column])`` is used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GeneralNdarray</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="n">ndim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span></div>


<span class="c1">###############</span>
<span class="c1">### Ndarray ###</span>
<span class="c1">###############</span>
<span class="k">class</span> <span class="nc">IsopyNdarray</span><span class="p">(</span><span class="n">IsopyArray</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">cls</span> <span class="ow">and</span> <span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ndim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1">#Do this early so no time is wasted if it fails</span>
        <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">allow_duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ndim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ndim</span> <span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ndim</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parameter &quot;ndim&quot; must be -1, 0 or 1&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">and</span> <span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pandas</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">to_records</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">tables</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">tables</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">void</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">],)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="p">))]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="p">,)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>

            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                                                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="n">v</span><span class="o">.</span><span class="n">dtype</span><span class="p">,)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">float64</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                                                                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

            <span class="n">values</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="k">if</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                                                        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
                <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">))</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;unable to convert values with type &quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot; to IsopyArray&#39;</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#IF there are no keys at this stage raise an error</span>
            <span class="k">raise</span> <span class="n">NoKeysError</span><span class="p">(</span><span class="s1">&#39;Keys argument not given and keys not found in values&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">allow_duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">vlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">vlen</span> <span class="o">=</span> <span class="p">{</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">}</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vlen</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;All rows in values are not the same size&#39;</span><span class="p">)</span>
            <span class="n">vlen</span> <span class="o">=</span> <span class="n">vlen</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">vlen</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;size of keys does not match size of values&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="n">float64</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="ow">and</span> <span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span> <span class="o">!=</span> <span class="n">vlen</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;number of dtypes given does not match number of keys&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span> <span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vlen</span><span class="p">)]</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">new_dtype</span> <span class="o">=</span> <span class="p">[</span><span class="n">dtype</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vlen</span><span class="p">)]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="n">dtype</span><span class="p">,)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vlen</span><span class="p">)]</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="n">colvalues</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">colvalues</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">))</span>

        <span class="n">dtype</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colvalues</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">new_dtype</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span> <span class="n">dtype</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unable to convert values for </span><span class="si">{</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> to one of the specified dtypes&#39;</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="o">.</span><span class="n">strlist</span><span class="p">(),</span> <span class="n">dtype</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">ndim</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">ndim</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">ndim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ndim</span> <span class="o">!=</span> <span class="n">out</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">out</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NDimError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot convert array with </span><span class="si">{</span><span class="n">out</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s1"> rows to 0-dimensions&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">tuple</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keystring</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">strlist</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IsopyNdarray</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keystring</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">KeyParseError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">IsopyNdarray</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">ndarray</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No column with the key &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot; in array&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">strlist</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">IsopyNdarray</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">IsopyNdarray</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__view_void</span><span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">IsopyNdarray</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">MassNdarray</span><span class="p">(</span><span class="n">MassFlavour</span><span class="p">,</span> <span class="n">IsopyNdarray</span><span class="p">,</span> <span class="n">MassArray</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">ElementNdarray</span><span class="p">(</span><span class="n">ElementFlavour</span><span class="p">,</span> <span class="n">IsopyNdarray</span><span class="p">,</span> <span class="n">ElementArray</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">IsotopeNdarray</span><span class="p">(</span><span class="n">IsotopeFlavour</span><span class="p">,</span> <span class="n">IsopyNdarray</span><span class="p">,</span> <span class="n">IsotopeArray</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">RatioNdarray</span><span class="p">(</span><span class="n">RatioFlavour</span><span class="p">,</span> <span class="n">IsopyNdarray</span><span class="p">,</span> <span class="n">RatioArray</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">GeneralNdarray</span><span class="p">(</span><span class="n">GeneralFlavour</span><span class="p">,</span> <span class="n">IsopyNdarray</span><span class="p">,</span> <span class="n">GeneralArray</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c1">############</span>
<span class="c1">### Void ###</span>
<span class="c1">############</span>

<span class="k">class</span> <span class="nc">IsopyVoid</span><span class="p">(</span><span class="n">IsopyArray</span><span class="p">,</span> <span class="n">void</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">void</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">void</span><span class="o">.</span><span class="n">view</span><span class="p">((</span><span class="bp">cls</span><span class="p">,</span> <span class="n">void</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;len() of unsized object&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> cannot be indexed by position&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keystring</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IsopyArray</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keystring</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">strlist</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;0-dimensional arrays cannot be indexed by row&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">IsopyVoid</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reshape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">MassVoid</span><span class="p">(</span><span class="n">MassFlavour</span><span class="p">,</span> <span class="n">IsopyVoid</span><span class="p">,</span> <span class="n">MassArray</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">ElementVoid</span><span class="p">(</span><span class="n">ElementFlavour</span><span class="p">,</span> <span class="n">IsopyVoid</span><span class="p">,</span> <span class="n">ElementArray</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">IsotopeVoid</span><span class="p">(</span><span class="n">IsotopeFlavour</span><span class="p">,</span> <span class="n">IsopyVoid</span><span class="p">,</span> <span class="n">IsotopeArray</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">RatioVoid</span><span class="p">(</span><span class="n">RatioFlavour</span><span class="p">,</span> <span class="n">IsopyVoid</span><span class="p">,</span> <span class="n">RatioArray</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">GeneralVoid</span><span class="p">(</span><span class="n">GeneralFlavour</span><span class="p">,</span> <span class="n">IsopyVoid</span><span class="p">,</span> <span class="n">GeneralArray</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c1">###############################################</span>
<span class="c1">### functions for creating isopy data types ###</span>
<span class="c1">###############################################</span>
<div class="viewcode-block" id="keystring"><a class="viewcode-back" href="../../refpages/Strings/isopy.keystring.html#isopy.keystring">[docs]</a><span class="nd">@lru_cache</span><span class="p">(</span><span class="n">CACHE_MAXSIZE</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">keystring</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert *string* into a key string and return it.</span>

<span class="sd">    Will attempt to convert *string* into a MassKeyString, ElementKeyString, IsotopeKeyString,</span>
<span class="sd">    RatioKeyString and finally a GeneralKeyString. The first successfully conversion is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MassKeyString</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">KeyStringException</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ElementKeyString</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">KeyStringException</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">IsotopeKeyString</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">KeyStringException</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">RatioKeyString</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">KeyStringException</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">GeneralKeyString</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">KeyStringException</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">raise</span> <span class="n">KeyParseError</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">IsopyKeyString</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;unable to parse </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="si">}</span><span class="s1"> &quot;</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s1">&quot; into a key string&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="askeystring"><a class="viewcode-back" href="../../refpages/Strings/isopy.askeystring.html#isopy.askeystring">[docs]</a><span class="nd">@lru_cache</span><span class="p">(</span><span class="n">CACHE_MAXSIZE</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">askeystring</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If *string* is a key string it is returned otherwise convert *string* to a key string and</span>
<span class="sd">    return it.</span>

<span class="sd">    Will attempt to convert *string* into a MassKeyString, ElementKeyString, IsotopeKeyString,</span>
<span class="sd">    RatioKeyString and finally a GeneralKeyString. The first successfully conversion is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">IsopyKeyString</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">keystring</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">)</span></div>


<div class="viewcode-block" id="keylist"><a class="viewcode-back" href="../../refpages/Lists/isopy.keylist.html#isopy.keylist">[docs]</a><span class="nd">@lru_cache</span><span class="p">(</span><span class="n">CACHE_MAXSIZE</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">keylist</span><span class="p">(</span><span class="o">*</span><span class="n">keys</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert *keys* into a key string list and return it. *keys* can be a string or a sequence of</span>
<span class="sd">    string.</span>

<span class="sd">    Will attempt to convert *keys* into a MassKeyList, ElementKeyList, IsotopeKeyList,</span>
<span class="sd">    RatioKeyList and finally a GeneralKeyList. The first successfully conversion is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MassKeyList</span><span class="p">(</span><span class="o">*</span><span class="n">keys</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="n">skip_duplicates</span><span class="p">,</span>
                           <span class="n">allow_duplicates</span><span class="o">=</span><span class="n">allow_duplicates</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">KeyStringException</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ElementKeyList</span><span class="p">(</span><span class="o">*</span><span class="n">keys</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="n">skip_duplicates</span><span class="p">,</span>
                              <span class="n">allow_duplicates</span><span class="o">=</span><span class="n">allow_duplicates</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">KeyStringException</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">IsotopeKeyList</span><span class="p">(</span><span class="o">*</span><span class="n">keys</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="n">skip_duplicates</span><span class="p">,</span>
                              <span class="n">allow_duplicates</span><span class="o">=</span><span class="n">allow_duplicates</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">KeyStringException</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">RatioKeyList</span><span class="p">(</span><span class="o">*</span><span class="n">keys</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="n">skip_duplicates</span><span class="p">,</span>
                           <span class="n">allow_duplicates</span><span class="o">=</span><span class="n">allow_duplicates</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">KeyStringException</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">GeneralKeyList</span><span class="p">(</span><span class="o">*</span><span class="n">keys</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="n">skip_duplicates</span><span class="p">,</span>
                              <span class="n">allow_duplicates</span><span class="o">=</span><span class="n">allow_duplicates</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">KeyStringException</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">raise</span> <span class="n">KeyParseError</span><span class="p">(</span><span class="s1">&#39;unable to parse keys into a key string list&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="askeylist"><a class="viewcode-back" href="../../refpages/Lists/isopy.askeylist.html#isopy.askeylist">[docs]</a><span class="nd">@lru_cache</span><span class="p">(</span><span class="n">CACHE_MAXSIZE</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">askeylist</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If *keys* is a key string list return it otherwise convert *keys* to a key string list and</span>
<span class="sd">    return it.</span>

<span class="sd">    Will attempt to convert *keys* into a MassKeyList, ElementKeyList, IsotopeKeyList,</span>
<span class="sd">    RatioKeyList and finally a GeneralKeyList. The first successfully conversion is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">IsopyKeyList</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">keys</span>

    <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">askeystring</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
    <span class="n">types</span> <span class="o">=</span> <span class="p">{</span><span class="n">flavour</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">}</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">types</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">GeneralKeyList</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">allow_reformatting</span><span class="o">=</span><span class="n">allow_reformatting</span><span class="p">)</span></div>


<div class="viewcode-block" id="array"><a class="viewcode-back" href="../../refpages/Arrays/isopy.array.html#isopy.array">[docs]</a><span class="k">def</span> <span class="nf">array</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">columns</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert the input arguments to a isopy array.</span>

<span class="sd">    Will attempt to convert the input arguments into a MassArray, ElementArray, IsotopeArray,</span>
<span class="sd">    RatioArray and finally a GeneralArray. The first successfully conversion is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No values were given&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;values and column kwargs cannot be given together&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">columns</span>

    <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="n">MassArray</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="n">ndim</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">KeyStringException</span><span class="p">:</span> <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="n">ElementArray</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="n">ndim</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">KeyStringException</span><span class="p">:</span> <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="n">IsotopeArray</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="n">ndim</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">KeyStringException</span><span class="p">:</span> <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="n">RatioArray</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="n">ndim</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">KeyStringException</span><span class="p">:</span> <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="n">GeneralArray</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="n">ndim</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">KeyStringException</span><span class="p">:</span> <span class="k">pass</span>

    <span class="k">raise</span> <span class="n">KeyParseError</span><span class="p">(</span><span class="s1">&#39;Unable to convert input to IsopyArray&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="asarray"><a class="viewcode-back" href="../../refpages/Arrays/isopy.asarray.html#isopy.asarray">[docs]</a><span class="k">def</span> <span class="nf">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If *a* is an isopy array return it otherwise convert *a* into an isopy array and return it. If</span>
<span class="sd">    *ndim* is given a view of the array with the specified dimensionality is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">IsopyArray</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ndim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">tuple</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">ndim</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;cannot make array with more than one value zero-dimensional&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ndim</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;the only accepted ndim values are -1, 0, and 1&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a</span></div>


<div class="viewcode-block" id="asanyarray"><a class="viewcode-back" href="../../refpages/Arrays/isopy.asanyarray.html#isopy.asanyarray">[docs]</a><span class="k">def</span> <span class="nf">asanyarray</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return ``isopy.asarray(a)`` if *a* possible otherwise return ``numpy.asanyarray(a)``.</span>

<span class="sd">    The data type and number of dimensions of the returned array can be specified by *dtype and</span>
<span class="sd">    *ndim*, respectively.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">IsopyArray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">a</span><span class="o">=</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dtype</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">err</span>

    <span class="k">if</span> <span class="n">ndim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="n">a</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">tuple</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">ndim</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;cannot make array with more than one value zero-dimensional&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="n">ndim</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">IsopyArray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="n">ndim</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unable to convert array to number of dimensions specified </span><span class="si">{</span><span class="n">ndim</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a</span></div>


<span class="c1">##################</span>
<span class="c1">### type tests ###</span>
<span class="c1">##################</span>
<span class="k">def</span> <span class="nf">iskeystring</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return ``True`` if *item* is a key string otherwise ``False`` is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">IsopyKeyString</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">iskeylist</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return ``True`` if *item* is a key string list otherwise ``False`` is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">IsopyKeyList</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">isarray</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return ``True`` if *item* is an isopy array otherwise ``False`` is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">IsopyArray</span><span class="p">)</span>


<span class="c1">###########################</span>
<span class="c1">### Create empty arrays ###</span>
<span class="c1">###########################</span>
<div class="viewcode-block" id="zeros"><a class="viewcode-back" href="../../refpages/Arrays/isopy.zeros.html#isopy.zeros">[docs]</a><span class="k">def</span> <span class="nf">zeros</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float64</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an isopy array filled with zeros.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rows : int, None</span>
<span class="sd">        Number of rows in the returned array. A value of ``-1`` or ``None``</span>
<span class="sd">        will return a 0-dimensional array unless overridden by *ndim*.</span>
<span class="sd">    keys : Sequence[str], Optional</span>
<span class="sd">        Column names for the returned array. Can also be inferred from *dtype* if *dtype* is a</span>
<span class="sd">        named ``np.dtype``.</span>
<span class="sd">    ndim : {-1, 0, 1}, Optional</span>
<span class="sd">        Dimensions of the final array. A value of ``-1`` will return an</span>
<span class="sd">        0-dimensional array if size is 1 otherwise a 1-dimensional array is returned.</span>
<span class="sd">        An exception is raised if value is ``0`` and *size* is not ``-1`` or ``1``.</span>
<span class="sd">    dtype : numpy_dtype, Sequence[numpy_dtype]</span>
<span class="sd">        Data type of returned array. A sequence of data types can given to specify</span>
<span class="sd">        different datatypes for different columns in the final array.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_new_empty_array</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">)</span></div>


<div class="viewcode-block" id="ones"><a class="viewcode-back" href="../../refpages/Arrays/isopy.ones.html#isopy.ones">[docs]</a><span class="k">def</span> <span class="nf">ones</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float64</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an isopy array filled with ones.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rows : int, None</span>
<span class="sd">        Number of rows in the returned array. A value of ``-1`` or ``None``</span>
<span class="sd">        will return a 0-dimensional array unless overridden by *ndim*.</span>
<span class="sd">    keys : Sequence[str], Optional</span>
<span class="sd">        Column names for the returned array. Can also be inferred from *dtype* if *dtype* is a</span>
<span class="sd">        named ``np.dtype``.</span>
<span class="sd">    ndim : {-1, 0, 1}, Optional</span>
<span class="sd">        Dimensions of the final array. A value of ``-1`` will return an</span>
<span class="sd">        0-dimensional array if size is 1 otherwise a 1-dimensional array is returned.</span>
<span class="sd">        An exception is raised if value is ``0`` and *size* is not ``-1`` or ``1``.</span>
<span class="sd">    dtype : numpy_dtype, Sequence[numpy_dtype]</span>
<span class="sd">        Data type of returned array. A sequence of data types can given to specify</span>
<span class="sd">        different datatypes for different columns in the final array.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_new_empty_array</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">)</span></div>


<div class="viewcode-block" id="empty"><a class="viewcode-back" href="../../refpages/Arrays/isopy.empty.html#isopy.empty">[docs]</a><span class="k">def</span> <span class="nf">empty</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float64</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an isopy array without initalising entries.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rows : int, None</span>
<span class="sd">        Number of rows in the returned array. A value of ``-1`` or ``None``</span>
<span class="sd">        will return a 0-dimensional array unless overridden by *ndim*.</span>
<span class="sd">    keys : Sequence[str], Optional</span>
<span class="sd">        Column names for the returned array. Can also be inferred from *dtype* if *dtype* is a</span>
<span class="sd">        named ``np.dtype``.</span>
<span class="sd">    ndim : {-1, 0, 1}, Optional</span>
<span class="sd">        Dimensions of the final array. A value of ``-1`` will return an</span>
<span class="sd">        0-dimensional array if size is 1 otherwise a 1-dimensional array is returned.</span>
<span class="sd">        An exception is raised if value is ``0`` and *size* is not ``-1`` or ``1``.</span>
<span class="sd">    dtype : numpy_dtype, Sequence[numpy_dtype]</span>
<span class="sd">        Data type of returned array. A sequence of data types can given to specify</span>
<span class="sd">        different datatypes for different columns in the final array.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_new_empty_array</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">)</span></div>


<div class="viewcode-block" id="full"><a class="viewcode-back" href="../../refpages/Arrays/isopy.full.html#isopy.full">[docs]</a><span class="k">def</span> <span class="nf">full</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float64</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an isopy array filled with *fill_value*.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rows : int, None</span>
<span class="sd">        Number of rows in the returned array. A value of ``-1`` or ``None``</span>
<span class="sd">        will return a 0-dimensional array unless overridden by *ndim*.</span>
<span class="sd">    fill_value</span>
<span class="sd">        the value the array will be filled with.</span>
<span class="sd">    keys : Sequence[str], Optional</span>
<span class="sd">        Column names for the returned array. Can also be inferred from *dtype* if *dtype* is a</span>
<span class="sd">        named ``np.dtype``.</span>
<span class="sd">    ndim : {-1, 0, 1}, Optional</span>
<span class="sd">        Dimensions of the final array. A value of ``-1`` will return an</span>
<span class="sd">        0-dimensional array if size is 1 otherwise a 1-dimensional array is returned.</span>
<span class="sd">        An exception is raised if value is ``0`` and *size* is not ``-1`` or ``1``.</span>
<span class="sd">    dtype : numpy_dtype, Sequence[numpy_dtype]</span>
<span class="sd">        Data type of returned array. A sequence of data types can given to specify</span>
<span class="sd">        different datatypes for different columns in the final array.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">_new_empty_array</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">copyto</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_new_empty_array</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">rows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">rows</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">elif</span> <span class="n">rows</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">():</span> <span class="n">rows</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">elif</span> <span class="n">rows</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">rows</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parameter &quot;rows&quot; must be -1 or a positive integer&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">keylist</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">allow_duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ndim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rows</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">shape</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">rows</span>
    <span class="k">elif</span> <span class="n">ndim</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">shape</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">rows</span>
    <span class="k">elif</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>  <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;cannot create an zero-dimensional array with more than one row&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ndim</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;accepted values for &quot;ndim&quot; is -1, 0,  or 1&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="ow">and</span> <span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">keylist</span><span class="p">(</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="n">allow_duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;size of dtype does not match size of keys&#39;</span><span class="p">)</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="p">[</span><span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">))]</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;dtype is an iterable but no keys were given&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;size of dtype does not match size of keys&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">keys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="p">[</span><span class="n">dtype</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">))]</span>

    <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="o">.</span><span class="n">strlist</span><span class="p">(),</span> <span class="n">dtype</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">keys</span><span class="o">.</span><span class="n">_Flavour__view_ndarray</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">zeros_like</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create and return an isopy array like *a* filled with zeros. If given, *dtype* will override</span>
<span class="sd">    the data type of the returned array. *dtype* can be a single data type of a sequence of</span>
<span class="sd">    data types, one for each column in *a*.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_new_like_array</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ones_like</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create and return an isopy array like *a* filled with ones. If given, *dtype* will override</span>
<span class="sd">    the data type of the returned array. *dtype* can be a single data type of a sequence of</span>
<span class="sd">    data types, one for each column in *a*.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_new_like_array</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">empty_like</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create and return an isopy array like *a* without initalised values. If given, *dtype* will override</span>
<span class="sd">    the data type of the returned array. *dtype* can be a single data type of a sequence of</span>
<span class="sd">    data types, one for each column in *a*.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_new_like_array</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">full_like</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create and return an isopy array like *a* filled with *fill_value*. If given, *dtype* will override</span>
<span class="sd">    the data type of the returned array. *dtype* can be a single data type of a sequence of</span>
<span class="sd">    data types, one for each column in *a*.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">_new_like_array</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">copyto</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_new_like_array</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">keylist</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">strlist</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;size of dtype does not match size of keys in array&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">dtype</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;size of dtype does not match size of keys in array&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="p">[</span><span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">))]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="p">[</span><span class="n">dtype</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="p">))]))</span>
    <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>

<span class="c1">######################################################</span>
<span class="c1">### reimplementationz of exisiting numpy functions ###</span>
<span class="c1">######################################################</span>
<span class="k">def</span> <span class="nf">concatenate</span><span class="p">(</span><span class="o">*</span><span class="n">arrays</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="n">nan</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Join arrays together along specified axis.</span>

<span class="sd">    Same function as ``np.concatenate`` with the additional option of specifying the default value for columns not</span>
<span class="sd">    present in all arrays.</span>

<span class="sd">    Normal numpy broadcasting rules apply so when concatenating columns the shape of the arrays must be compatible.</span>
<span class="sd">    When array with a size of 1 is concatenated to an array of a different size it will be copied into every row</span>
<span class="sd">    of the new shape.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    arrays</span>
<span class="sd">        Arrays to be joined together.</span>
<span class="sd">    axis</span>
<span class="sd">        If 0 then the rows of each array in *arrays* will be concatenated. If 1 then the columns of each array will</span>
<span class="sd">        be concatenated. If *axis* is 1 an error will be raised if a column key occurs in more than one array.</span>
<span class="sd">    default_value : float, optional</span>
<span class="sd">        The default value for any columns that are missing when concatenating rows. Default value is ``np.nan``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    IsopyArray</span>
<span class="sd">        Array containing all the row data and all the columns keys found in *arrays*.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arrays</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span> <span class="n">arrays</span> <span class="o">=</span> <span class="n">arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">arrays</span> <span class="o">=</span> <span class="p">[</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">]</span>
    <span class="n">arrays</span> <span class="o">=</span> <span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="n">array</span> <span class="k">for</span> <span class="n">array</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">]</span>

    <span class="n">types</span> <span class="o">=</span> <span class="p">{</span><span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">}</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">((</span><span class="n">atype</span><span class="o">:=</span><span class="n">types</span><span class="o">.</span><span class="n">pop</span><span class="p">()),</span> <span class="n">IsopyArray</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">_list</span> <span class="o">=</span> <span class="n">keylist</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_list</span> <span class="o">=</span> <span class="n">atype</span><span class="o">.</span><span class="n">_Flavour__keylist</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1">#extend rows</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">atype</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">),</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#return atype({key: np.concatenate([a.get(key, default_value) for a in arrays]) for key in keys})</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="o">.</span><span class="n">strlist</span><span class="p">())]</span>
        <span class="k">return</span> <span class="n">atype</span><span class="o">.</span><span class="n">_Flavour__view_ndarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fromiter</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">result</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1">#extend columns</span>
        <span class="n">size</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;all arrays must have the same size concatenating in axis 1&#39;</span><span class="p">)</span>

        <span class="n">keys</span> <span class="o">=</span> <span class="n">_list</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">),</span> <span class="n">allow_duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default_value</span><span class="p">))</span>

        <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="o">.</span><span class="n">strlist</span><span class="p">())]</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">keys</span><span class="o">.</span><span class="n">_Flavour__view_ndarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">keys</span><span class="o">.</span><span class="n">_Flavour__view_ndarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fromiter</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">result</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">np</span><span class="o">.</span><span class="n">AxisError</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;isopy.concatenate only accepts axis values of 0 or 1&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">argfunc</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="n">_function_signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">args</span><span class="p">))</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;axis&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">func</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">keys</span><span class="o">.</span><span class="n">_Flavour__view_ndarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">([</span><span class="n">array</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">array</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">array</span><span class="o">.</span><span class="n">_Flavour__array</span><span class="p">({</span><span class="n">keys</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">result</span> <span class="o">/</span> <span class="n">array</span><span class="o">.</span><span class="n">size</span><span class="p">)]:</span> <span class="n">result</span> <span class="o">%</span> <span class="n">array</span><span class="o">.</span><span class="n">size</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;axis value &quot;</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">&quot; unsupported&#39;</span><span class="p">)</span>


<span class="n">reimplmented_functions</span> <span class="o">=</span> <span class="p">{</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">:</span> <span class="n">concatenate</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">:</span> <span class="n">concatenate</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">sortkeys</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">askeylist</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">_Flavour__keylist</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="p">[</span><span class="n">_sortval</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">a</span><span class="p">]))</span>


<span class="nd">@lru_cache</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_sortval</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">MassFlavour</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">ElementFlavour</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">isopy</span><span class="o">.</span><span class="n">refval</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">atomic_number</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">IsotopeFlavour</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">mass_number</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="si">}{</span><span class="n">isopy</span><span class="o">.</span><span class="n">refval</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">atomic_number</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">RatioFlavour</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_sortval</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">denominator</span><span class="p">)</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">_sortval</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">numerator</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">key</span>
<span class="c1">###############################################</span>
<span class="c1">### numpy function overrides via            ###</span>
<span class="c1">###__array_ufunc__ and __array_function__   ###</span>
<span class="c1">###############################################</span>
<span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="n">CACHE_MAXSIZE</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_function_signature</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="c1">#returns the signature and number of input arguments for a function</span>
    <span class="c1">#An input argument is given as any argument that does not have a default value</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1">#No signature avaliable. Should be a rare occurance but applies to for example</span>
        <span class="c1"># concatenate (which wont call this anyway)</span>
        <span class="c1">#This return assumes all args are inputs</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> \
            <span class="nb">len</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="n">p</span><span class="o">.</span><span class="n">empty</span><span class="p">)])</span>


<span class="k">class</span> <span class="nc">_getter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the same array for all calls to get. Used for array function</span>
<span class="sd">     inputs that are not isopy arrays or dicts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">array_function</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span> <span class="n">nan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to call numpy ufuncs/functions on isopy arrays.</span>

<span class="sd">    This function produces the expected result for the majority, but not all, numpy functions.</span>
<span class="sd">    With a few exceptions all calls to numpy functions on isopy arrays will be sent to this function</span>
<span class="sd">     via the __array_ufunc__ and __array_function__ interface.</span>

<span class="sd">    If axis == 0 then the function is called on each column present in the isopy arrays given as</span>
<span class="sd">    input. Isopy arrays given as kwargs are not used taken into consideration when determining the</span>
<span class="sd">    returned array. Analogous to ``isopy.array({key: func(array.get(key, default_value), **kwargs)}</span>
<span class="sd">    for key in array.keys())`` for a single isopy array input.</span>

<span class="sd">    If all isopy arrays in inputs are of the same flavour then the returned array will have the</span>
<span class="sd">    same flavour. If the inputs are of different flavours then the returned array will be a</span>
<span class="sd">    GeneralArray</span>

<span class="sd">    If axis == 1 or None the function is called once with all isopy arrays are converted to lists.</span>
<span class="sd">    Only isopy arrays given as input are used to determine the keys used when converting isopy</span>
<span class="sd">    arrays to lists. Analogous to ``func([array.get(key, default_value) for key</span>
<span class="sd">    in array.keys()], axis, **kwargs)`` for a single isopy array input.</span>


<span class="sd">    Function must accept an axis keyword argument if axis == 1 or None. No axis keyword is passed if</span>
<span class="sd">    axis == 1.</span>

<span class="sd">    If inputs contain no isopy arrays then the function is called on the inputs and kwargs as is.</span>
<span class="sd">    Analogous to ``func(*inputs, **kwargs)``.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func : callable</span>
<span class="sd">        Function that will be called on input.</span>
<span class="sd">    *inputs : IsopyArray, dict, array_like</span>
<span class="sd">        Isopy arrays given here will determine the flavour and the keys of the returned array.</span>
<span class="sd">        All inputs that are not isopy arrays or dicts will be passed as it to each function call.</span>
<span class="sd">    axis : {0, 1, None}, default = 0</span>
<span class="sd">        The axis on which the function should be called. If 0 the function is called on each column</span>
<span class="sd">        present in the input. If 1 or None the function is called once with all isopy arrays in</span>
<span class="sd">        inputs and kwargs turned into lists. If axis is 1 or None no axis argument is passed to the</span>
<span class="sd">        function.</span>
<span class="sd">    default_value : int, float, default = np.nan</span>
<span class="sd">        Default value used for a column if it is not present in an array. If a scalar is given</span>
<span class="sd">        it will be used to represent the value for every row in the column.</span>
<span class="sd">    **kwargs</span>
<span class="sd">        Keyword arguments to be supplied to the function. Keyword arguments that are isopy arrays or</span>
<span class="sd">        dicts will behave the same as those in inputs but will not be used to .</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    IsopyArray, np.ndarray</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    An attempt will be made to convert any structured numpy array in inputs to a isopy array. This</span>
<span class="sd">    is *not* attempted for any structured numpy arrays given in kwargs.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    concancate, append</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">new_inputs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">IsopyArray</span><span class="p">):</span>
            <span class="n">new_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="n">default_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">default_value</span><span class="p">)</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asarray</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">new_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_inputs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">default_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">default_value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">IsopyDict</span><span class="p">):</span>
            <span class="n">new_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="n">default_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">default_value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">new_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IsopyDict</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
            <span class="n">default_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">default_value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_getter</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
            <span class="n">default_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">default_value</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="fm">__or__</span><span class="p">(</span><span class="o">*</span><span class="n">keys</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="n">NotGiven</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;axis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">keykwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">kw</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span> <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">kw</span><span class="p">],</span> <span class="n">IsopyArray</span><span class="p">)}</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span> <span class="k">for</span> <span class="nb">input</span><span class="p">,</span> <span class="n">default_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">new_inputs</span><span class="p">,</span> <span class="n">default_values</span><span class="p">)),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                       <span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">keykwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;dtype&#39;</span><span class="p">,</span> <span class="n">float64</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;ndim&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">keys</span><span class="o">.</span><span class="n">_Flavour__view_ndarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">keys</span><span class="o">.</span><span class="n">_Flavour__view_ndarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fromiter</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">result</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">out</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">kwk</span><span class="p">,</span> <span class="n">kwv</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwv</span><span class="p">,</span> <span class="p">(</span><span class="n">IsopyArray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;kwk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">kwv</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">])</span>

        <span class="n">new_inputs</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span> <span class="k">if</span>
                      <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">_getter</span><span class="p">)</span> <span class="k">else</span> <span class="nb">input</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">new_inputs</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">new_inputs</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Mattias Ek.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>